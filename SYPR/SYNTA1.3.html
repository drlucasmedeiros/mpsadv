<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEKO ‚Ä¢ Conex√µes Globais ‚Ä¢ GPS Obrigat√≥rio</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fbbf24">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== VARIABLES ===== */
        :root {
            /* Yellow Theme */
            --primary: #fbbf24;
            --primary-dark: #f59e0b;
            --primary-light: #fde68a;
            --primary-50: #fffbeb;
            --primary-100: #fef3c7;
            --primary-900: #78350f;
            
            /* Complementary Colors */
            --secondary: #3b82f6;
            --secondary-dark: #2563eb;
            --accent: #10b981;
            --accent-dark: #059669;
            --accent-50: #ecfdf5;
            --danger: #ef4444;
            --danger-50: #fef2f2;
            --warning: #f97316;
            --warning-50: #fffbeb;
            
            /* Neutral */
            --light: #f8fafc;
            --dark: #1e293b;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            /* Effects */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 32px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.15);
            
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-dark));
            --gradient-sunrise: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #f97316 100%);
            --gradient-ocean: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            --gradient-success: linear-gradient(135deg, var(--accent), var(--accent-dark));
            
            --glass-bg: rgba(255, 251, 235, 0.92);
            --glass-border: rgba(251, 191, 36, 0.2);
            --blur-amount: 16px;
        }
        
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
            height: 100%;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary-50) 0%, #fff 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Background Pattern */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(251, 191, 36, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 90% 80%, rgba(59, 130, 246, 0.05) 0%, transparent 25%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.05) 0%, transparent 35%);
            z-index: -2;
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .display-1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient-sunrise);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .display-2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-900);
        }
        
        @media (max-width: 768px) {
            .display-1 { font-size: 2.5rem; }
            .display-2 { font-size: 2rem; }
        }
        
        /* ===== LAYOUT ===== */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ===== HEADER ===== */
        .main-header {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            border-bottom: 1px solid var(--glass-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 2rem;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-900);
            text-decoration: none;
        }
        
        .logo-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--gradient-sunrise);
            border-radius: var(--radius-md);
            color: white;
            font-size: 1.25rem;
        }
        
        /* ===== NAVIGATION ===== */
        .nav-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-full);
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 600;
            transition: var(--transition);
            position: relative;
        }
        
        .nav-item:hover {
            background: var(--primary-100);
            color: var(--primary-900);
        }
        
        .nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }
        
        .badge {
            background: var(--danger);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
        }
        
        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            padding: 2rem;
        }
        
        /* ===== ACCESS SCREEN ===== */
        .access-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            padding: 2rem;
            text-align: center;
        }
        
        .hero-section {
            max-width: 800px;
            margin: 0 auto 3rem;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-top: 1rem;
        }
        
        .access-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--primary-100);
            max-width: 480px;
            width: 100%;
        }
        
        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }
        
        .form-hint {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.5rem;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-decoration: none;
            user-select: none;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: var(--gradient-sunrise);
            color: white;
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 6px 24px rgba(251, 191, 36, 0.5);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary-900);
            border: 2px solid var(--primary);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--primary-50);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary-900);
            border: 2px solid var(--primary-300);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-small {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        /* ===== DASHBOARD GRID ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }
        
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== SIDEBAR ===== */
        .sidebar {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--primary-100);
            height: fit-content;
            position: sticky;
            top: 6rem;
        }
        
        .user-card {
            text-align: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1.5rem;
        }
        
        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient-sunrise);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 2rem;
            font-weight: 700;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.3);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-code {
            background: var(--primary-50);
            border: 2px dashed var(--primary);
            color: var(--primary-900);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-full);
            font-family: 'Space Grotesk', monospace;
            font-weight: 700;
            font-size: 1.125rem;
            letter-spacing: 1px;
        }
        
        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            text-align: center;
            border: 1px solid var(--gray-200);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-900);
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: 0.5rem;
        }
        
        /* ===== CONTENT AREA ===== */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .page-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .page-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-100);
        }
        
        .section-title {
            font-size: 1.75rem;
            color: var(--primary-900);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-title i {
            color: var(--primary);
        }
        
        /* ===== POSTS GRID ===== */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        
        .post-card {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
            transition: var(--transition);
            position: relative;
        }
        
        .post-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }
        
        .post-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .post-category {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--primary-50);
            color: var(--primary-900);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .post-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }
        
        .post-description {
            color: var(--gray-600);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .post-footer {
            padding: 1.25rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .post-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        .post-distance {
            background: var(--primary);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.75rem;
        }
        
        /* ===== CHAT INTERFACE ===== */
        .chat-container {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            height: 70vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            background: var(--primary-50);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            max-width: 75%;
            padding: 1rem 1.25rem;
            border-radius: var(--radius-lg);
            position: relative;
            animation: slideIn 0.3s ease;
        }
        
        .message.sent {
            background: var(--gradient-sunrise);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .message.received {
            background: var(--gray-100);
            color: var(--gray-800);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .message-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 0.375rem;
            text-align: right;
        }
        
        .chat-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            background: white;
        }
        
        /* ===== MAP CONTAINER ===== */
        .map-container {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            height: 60vh;
            margin-bottom: 2rem;
        }
        
        #globalMap {
            width: 100%;
            height: 100%;
        }
        
        .map-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .map-stat {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--gray-200);
        }
        
        /* ===== ADMIN PANEL ===== */
        .admin-panel {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .admin-stat {
            background: var(--primary-50);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            border: 2px solid var(--primary-100);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .data-table th {
            background: var(--primary-50);
            color: var(--primary-900);
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background: var(--gray-50);
        }
        
        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--primary-100);
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-100);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-900);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1500;
            border-left: 4px solid var(--primary);
            max-width: 400px;
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-sunrise);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        /* ===== LOADING STATES ===== */
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--primary-100);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        .skeleton {
            background: linear-gradient(90deg, var(--primary-100) 25%, var(--primary-50) 50%, var(--primary-100) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-md);
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .main-header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-container {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .access-card {
                padding: 1.5rem;
            }
            
            .display-1 {
                font-size: 2.5rem;
            }
            
            .map-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .posts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .display-1 {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .map-stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-primary { color: var(--primary-900); }
        .text-muted { color: var(--gray-500); }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .d-none { display: none !important; }
        .d-flex { display: flex; }
        .flex-column { flex-direction: column; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .w-100 { width: 100%; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        
        /* ===== EMPTY STATES ===== */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray-500);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            color: var(--primary);
        }
        
        /* ===== INSTALL PROMPT ===== */
        .install-prompt {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            right: 2rem;
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1500;
            transform: translateY(120%);
            transition: transform 0.3s ease;
            border: 2px solid var(--primary);
        }
        
        .install-prompt.active {
            transform: translateY(0);
        }
        
        /* ===== RATING STARS ===== */
        .rating-stars {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem 0;
        }
        
        .star {
            font-size: 2.5rem;
            color: var(--gray-300);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .star.active,
        .star:hover,
        .star.hover {
            color: var(--primary);
            transform: scale(1.1);
        }
        
        .star.selected {
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }
        
        .rating-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-900);
            margin-left: 0.5rem;
        }
        
        /* ===== REVIEWS ===== */
        .review-card {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--gray-200);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .review-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .review-star {
            color: var(--primary);
            font-size: 0.875rem;
        }
        
        .review-date {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        .review-comment {
            color: var(--gray-700);
            line-height: 1.5;
        }
        
        /* ===== ALERTS ===== */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-md);
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: var(--primary-50);
            border-color: var(--primary);
        }
        
        .alert-success {
            background: var(--accent-50);
            border-color: var(--accent);
        }
        
        .alert-warning {
            background: var(--warning-50);
            border-color: var(--warning);
        }
        
        .alert-danger {
            background: var(--danger-50);
            border-color: var(--danger);
        }
        
        /* ===== CONVERSATION ITEM ===== */
        .conversation-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--gray-200);
        }
        
        .conversation-item:hover {
            background: var(--gray-50);
            border-color: var(--primary);
        }
        
        .conversation-item.unread {
            background: var(--primary-50);
            border-color: var(--primary-100);
        }
        
        /* ===== CODE DISPLAY ===== */
        .code-display {
            font-family: 'Courier New', monospace;
            background: var(--gray-100);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            border: 2px dashed var(--gray-300);
            text-align: center;
            letter-spacing: 1px;
        }
        
        /* ===== GPS INDICATOR ===== */
        .gps-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .gps-active {
            background: var(--accent-50);
            color: var(--accent-dark);
            border: 1px solid var(--accent);
        }
        
        .gps-inactive {
            background: var(--danger-50);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        /* ===== CHAT CONTROLS ===== */
        .chat-controls {
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ===== INPUT GROUP ===== */
        .input-group {
            display: flex;
            gap: 0.5rem;
        }
        
        /* ===== DARK MODE ===== */
        @media (prefers-color-scheme: dark) {
            :root {
                --light: #0f172a;
                --dark: #f8fafc;
                --gray-50: #0f172a;
                --gray-100: #1e293b;
                --gray-200: #334155;
                --gray-300: #475569;
                --gray-400: #64748b;
                --gray-500: #94a3b8;
                --gray-600: #cbd5e1;
                --gray-700: #e2e8f0;
                --gray-800: #f1f5f9;
                --gray-900: #f8fafc;
                
                --primary-50: #78350f;
                --primary-100: #92400e;
                --primary-900: #fef3c7;
                
                --glass-bg: rgba(15, 23, 42, 0.92);
                --glass-border: rgba(251, 191, 36, 0.2);
            }
            
            body {
                background: linear-gradient(135deg, var(--gray-50) 0%, #1e293b 100%);
                color: var(--dark);
            }
            
            .access-card,
            .sidebar,
            .post-card,
            .chat-container,
            .modal,
            .notification,
            .install-prompt,
            .admin-panel {
                background: var(--gray-100);
                border-color: var(--gray-200);
            }
            
            .form-control {
                background: var(--gray-200);
                border-color: var(--gray-300);
                color: var(--gray-800);
            }
            
            .form-control:focus {
                border-color: var(--primary);
            }
            
            .post-title,
            .section-title,
            .modal-title {
                color: var(--gray-800);
            }
            
            .post-description {
                color: var(--gray-600);
            }
            
            .post-footer {
                background: var(--gray-200);
                border-color: var(--gray-300);
            }
            
            .stat-card {
                background: var(--gray-200);
                border-color: var(--gray-300);
            }
            
            .message.received {
                background: var(--gray-200);
                color: var(--gray-800);
            }
            
            .star {
                color: var(--gray-600);
            }
            
            .star.selected {
                color: #ffc107;
            }
            
            .review-card {
                background: var(--gray-200);
                border-color: var(--gray-300);
            }
            
            .code-display {
                background: var(--gray-200);
                border-color: var(--gray-400);
            }
        }
    </style>
</head>
<body>
    <!-- Background Pattern -->
    <div class="bg-pattern"></div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="main-header">
            <div class="header-content">
                <a href="#" class="logo" id="homeLogo">
                    <div class="logo-icon">
                        <i class="fas fa-globe-americas"></i>
                    </div>
                    <span>SYPER</span>
                </a>
                
                <nav class="nav-container">
                    <a href="#" class="nav-item active" data-page="feed">
                        <i class="fas fa-home"></i>
                        <span>Feed</span>
                    </a>
                    <a href="#" class="nav-item" data-page="messages">
                        <i class="fas fa-comments"></i>
                        <span>Mensagens</span>
                        <span class="badge d-none" id="messageBadge">0</span>
                    </a>
                    <a href="#" class="nav-item" data-page="map">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Mapa</span>
                    </a>
                    <a href="#" class="nav-item" data-page="profile">
                        <i class="fas fa-user"></i>
                        <span>Perfil</span>
                    </a>
                    <a href="#" class="nav-item" data-page="reviews">
                        <i class="fas fa-star"></i>
                        <span>Avalia√ß√µes</span>
                    </a>
                    <a href="#" class="nav-item d-none" data-page="admin" id="adminNav">
                        <i class="fas fa-shield-alt"></i>
                        <span>Admin</span>
                    </a>
                </nav>
                
                <div class="d-flex align-center gap-2">
                    <div class="gps-indicator gps-active" id="gpsStatus">
                        <i class="fas fa-satellite"></i>
                        <span>GPS Ativo</span>
                    </div>
                    <div class="user-code d-none" id="userCodeHeader">SYNTA-XXXXXX</div>
                    <button class="btn btn-primary btn-small" id="newPostBtn">
                        <i class="fas fa-plus"></i>
                        <span>Nova Proposta</span>
                    </button>
                    <button class="btn btn-outline btn-small" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Access Screen -->
            <section id="accessScreen" class="access-screen">
                <div class="hero-section">
                    <h1 class="display-1">Conecte-se com o Mundo</h1>
                    <p class="hero-subtitle">
                        Uma plataforma global onde ideias se encontram. An√¥nimo. Seguro. GPS Obrigat√≥rio.
                    </p>
                </div>
                
                <div class="access-card">
                    <h2 class="display-2 mb-3">Acesso por C√≥digo</h2>
                    
                    <div class="alert alert-info mb-3">
                        <div class="d-flex align-center gap-1">
                            <i class="fas fa-satellite"></i>
                            <div>
                                <strong>GPS Obrigat√≥rio</strong>
                                <p class="mb-0">O SYNTA requer acesso √† sua localiza√ß√£o para funcionar corretamente.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="demo-access mb-3">
                        <p class="text-muted mb-2">Para teste r√°pido, use:</p>
                        <div class="d-flex gap-2 mb-3">
                            <button class="btn btn-secondary btn-small" onclick="SYNTA.login('SYNTA-ADMIN')">
                                <i class="fas fa-crown"></i> ADMIN
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="SYNTA.login('SYNTA-USER')">
                                <i class="fas fa-user"></i> USER
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="SYNTA.quickStart()">
                                <i class="fas fa-bolt"></i> R√ÅPIDO
                            </button>
                        </div>
                    </div>
                    
                    <form id="accessForm">
                        <div class="form-group">
                            <label class="form-label">Seu C√≥digo SYNTA</label>
                            <input type="text" class="form-control" id="accessCode" 
                                   placeholder="SYNTA-XXXXXX" required
                                   pattern="SYNTA-[A-Z0-9]{6}"
                                   title="Formato: SYNTA- seguido de 6 caracteres">
                            <div class="form-hint">
                                Digite o c√≥digo recebido ou <a href="#" id="createAccountLink">crie uma conta</a>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label d-flex align-center gap-1">
                                <input type="checkbox" id="enableLocation" checked disabled>
                                <span>Usar minha localiza√ß√£o GPS (obrigat√≥rio)</span>
                            </label>
                            <div class="form-hint" id="locationStatus">
                                <i class="fas fa-map-marker-alt"></i> Verificando GPS...
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block" id="accessSubmit" disabled>
                            <i class="fas fa-unlock"></i> Acessar Plataforma
                        </button>
                    </form>
                    
                    <div class="mt-3 text-center">
                        <p class="text-muted">Primeira vez aqui?</p>
                        <button class="btn btn-secondary" onclick="SYNTA.createAccount()">
                            <i class="fas fa-user-plus"></i> Criar Nova Conta
                        </button>
                    </div>
                </div>
                
                <div class="mt-4">
                    <p class="text-muted">
                        <i class="fas fa-lock"></i> 100% an√¥nimo ‚Ä¢ 
                        <i class="fas fa-map-marker-alt"></i> Baseado em GPS ‚Ä¢ 
                        <i class="fas fa-star"></i> Sistema de reputa√ß√£o ‚Ä¢ 
                        <i class="fas fa-globe"></i> Raio de 50km
                    </p>
                </div>
            </section>
            
            <!-- Dashboard Content (Hidden Initially) -->
            <div id="dashboardContent" class="d-none">
                <div class="dashboard-grid">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <div class="user-card">
                            <div class="user-avatar" id="userAvatar">
                                <span id="avatarText">U</span>
                            </div>
                            <h3 class="text-primary mb-1" id="userName">Usu√°rio SYNTA</h3>
                            <p class="text-muted mb-2" id="userLocation">Localiza√ß√£o n√£o definida</p>
                            <div class="user-code" id="userCodeSidebar">SYNTA-XXXXXX</div>
                            <div class="mt-2">
                                <div class="rating-stars" style="justify-content: center; font-size: 1.2rem;">
                                    <i class="fas fa-star ${SYNTA.getUserRatingClass(5)}"></i>
                                    <i class="fas fa-star ${SYNTA.getUserRatingClass(4)}"></i>
                                    <i class="fas fa-star ${SYNTA.getUserRatingClass(3)}"></i>
                                    <i class="fas fa-star ${SYNTA.getUserRatingClass(2)}"></i>
                                    <i class="fas fa-star ${SYNTA.getUserRatingClass(1)}"></i>
                                    <span class="rating-value" id="userRatingValue">5.0</span>
                                </div>
                                <p class="text-muted" style="font-size: 0.875rem;">
                                    <span id="userReviewCount">0</span> avalia√ß√µes
                                </p>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="activePosts">0</div>
                                <div class="stat-label">Propostas Ativas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="unreadMessages">0</div>
                                <div class="stat-label">Mensagens</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="connections">0</div>
                                <div class="stat-label">Conex√µes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="reputation">100</div>
                                <div class="stat-label">Reputa√ß√£o</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button class="btn btn-secondary btn-block" id="editProfileBtn">
                                <i class="fas fa-user-edit"></i> Editar Perfil
                            </button>
                        </div>
                        
                        <div class="mt-3 pt-3 border-top">
                            <h4 class="text-primary mb-2">
                                <i class="fas fa-satellite"></i> Status GPS
                            </h4>
                            <div id="gpsSidebarStatus" class="gps-indicator gps-active">
                                <i class="fas fa-check-circle"></i>
                                <span>GPS Ativo</span>
                            </div>
                            <div class="text-muted mt-1" style="font-size: 0.875rem;">
                                Precis√£o: <span id="gpsAccuracy">0</span>m
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Main Content Area -->
                    <div class="content-area">
                        <!-- Feed Page -->
                        <section id="feedPage" class="page-section active">
                            <div class="section-header">
                                <div>
                                    <h2 class="section-title">
                                        <i class="fas fa-newspaper"></i> Feed Local (50km)
                                    </h2>
                                    <p class="text-muted" id="feedLocation">Carregando localiza√ß√£o...</p>
                                </div>
                                <div class="d-flex gap-1">
                                    <button class="btn btn-outline btn-small active" data-filter="nearby">
                                        <i class="fas fa-walking"></i> Pr√≥ximo
                                    </button>
                                    <button class="btn btn-outline btn-small" data-filter="trending">
                                        <i class="fas fa-fire"></i> Em Alta
                                    </button>
                                    <button class="btn btn-outline btn-small" data-filter="newest">
                                        <i class="fas fa-clock"></i> Recentes
                                    </button>
                                </div>
                            </div>
                            
                            <div class="posts-grid" id="postsGrid">
                                <!-- Posts will be loaded here -->
                            </div>
                            
                            <div class="empty-state d-none" id="emptyFeed">
                                <div class="empty-state-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <h3 class="text-primary mb-2">Nenhuma proposta dentro de 50km</h3>
                                <p class="text-muted mb-3">Seja o primeiro a criar uma proposta na sua √°rea!</p>
                                <button class="btn btn-primary" id="createFirstPost">
                                    <i class="fas fa-plus"></i> Criar Primeira Proposta
                                </button>
                            </div>
                        </section>
                        
                        <!-- Messages Page -->
                        <section id="messagesPage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-comments"></i> Mensagens
                                </h2>
                                <button class="btn btn-primary btn-small" id="newConversationBtn">
                                    <i class="fas fa-plus"></i> Nova Conversa
                                </button>
                            </div>
                            
                            <div class="conversations-list" id="conversationsList">
                                <!-- Conversations will be loaded here -->
                            </div>
                            
                            <div class="empty-state d-none" id="emptyMessages">
                                <div class="empty-state-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <h3 class="text-primary mb-2">Nenhuma conversa</h3>
                                <p class="text-muted">Envie propostas para iniciar conversas</p>
                            </div>
                        </section>
                        
                        <!-- Chat Page -->
                        <section id="chatPage" class="page-section">
                            <div class="chat-container">
                                <div class="chat-header">
                                    <button class="btn btn-outline btn-small" id="backToMessages">
                                        <i class="fas fa-arrow-left"></i>
                                    </button>
                                    <div class="user-avatar" style="width: 48px; height: 48px;" id="chatAvatar">U</div>
                                    <div style="flex: 1;">
                                        <h4 class="text-primary mb-0" id="chatName">Carregando...</h4>
                                        <p class="text-muted" style="font-size: 0.875rem;" id="chatStatus">
                                            <i class="fas fa-circle" style="color: var(--accent); font-size: 0.75rem;"></i> Online
                                        </p>
                                    </div>
                                    <div class="rating-stars" style="font-size: 1rem;">
                                        <i class="fas fa-star"></i>
                                        <span id="chatUserRating">5.0</span>
                                    </div>
                                </div>
                                
                                <div class="chat-messages" id="chatMessages">
                                    <!-- Messages will be loaded here -->
                                </div>
                                
                                <div class="chat-controls">
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-success btn-small" id="acceptProposalBtn">
                                            <i class="fas fa-handshake"></i> Proposta Aceita
                                        </button>
                                        <button class="btn btn-outline btn-small" id="reportUserBtn">
                                            <i class="fas fa-flag"></i> Denunciar
                                        </button>
                                    </div>
                                    <div class="d-flex gap-2" style="flex: 1; max-width: 600px;">
                                        <input type="text" class="form-control" id="messageInput" 
                                               placeholder="Digite sua mensagem..." disabled>
                                        <button class="btn btn-primary" id="sendMessageBtn" disabled>
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Map Page -->
                        <section id="mapPage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-map-marked-alt"></i> Mapa Local (50km)
                                </h2>
                                <div class="d-flex gap-1">
                                    <button class="btn btn-secondary btn-small" id="locateMeBtn">
                                        <i class="fas fa-location-arrow"></i>
                                    </button>
                                    <button class="btn btn-secondary btn-small" id="refreshMapBtn">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="map-container">
                                <div id="globalMap"></div>
                            </div>
                            
                            <div class="map-stats mt-3">
                                <div class="map-stat">
                                    <div class="stat-value" id="totalPosts">0</div>
                                    <div class="stat-label">Propostas Ativas</div>
                                </div>
                                <div class="map-stat">
                                    <div class="stat-value" id="activeUsers">0</div>
                                    <div class="stat-label">Usu√°rios Online</div>
                                </div>
                                <div class="map-stat">
                                    <div class="stat-value" id="connectionsToday">0</div>
                                    <div class="stat-label">Conex√µes Hoje</div>
                                </div>
                                <div class="map-stat">
                                    <div class="stat-value" id="averageRating">5.0</div>
                                    <div class="stat-label">Avalia√ß√£o M√©dia</div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Profile Page -->
                        <section id="profilePage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-user"></i> Meu Perfil
                                </h2>
                                <button class="btn btn-primary btn-small" id="myPostsBtn">
                                    <i class="fas fa-newspaper"></i> Minhas Postagens
                                </button>
                            </div>
                            
                            <div class="admin-panel">
                                <form id="profileForm">
                                    <div class="form-group">
                                        <label class="form-label">Nome de Exibi√ß√£o</label>
                                        <input type="text" class="form-control" id="displayName" 
                                               placeholder="Como voc√™ quer ser chamado" maxlength="30">
                                        <div class="form-hint">Pode ser um apelido para manter o anonimato</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Foto de Perfil (URL)</label>
                                        <input type="url" class="form-control" id="avatarUrl" 
                                               placeholder="https://exemplo.com/foto.jpg">
                                        <div class="form-hint">
                                            Use servi√ßos como <a href="https://imgbb.com" target="_blank">ImgBB</a> para upload gratuito
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Email para notifica√ß√µes</label>
                                        <input type="email" class="form-control" id="userEmail" 
                                               placeholder="seu@email.com">
                                        <div class="form-hint">Opcional - para notifica√ß√µes de novas mensagens</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Notifica√ß√µes</label>
                                        <div class="d-flex flex-column gap-1">
                                            <label class="d-flex align-center gap-1">
                                                <input type="checkbox" id="notifyMessages" checked>
                                                <span>Novas mensagens</span>
                                            </label>
                                            <label class="d-flex align-center gap-1">
                                                <input type="checkbox" id="notifyProposals" checked>
                                                <span>Novas propostas</span>
                                            </label>
                                            <label class="d-flex align-center gap-1">
                                                <input type="checkbox" id="notifyReviews" checked>
                                                <span>Novas avalia√ß√µes</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Salvar Altera√ß√µes
                                        </button>
                                        <button type="button" class="btn btn-secondary" id="resetProfileBtn">
                                            <i class="fas fa-undo"></i> Redefinir
                                        </button>
                                    </div>
                                </form>
                                
                                <div class="mt-4 pt-4 border-top">
                                    <h4 class="text-primary mb-3">
                                        <i class="fas fa-chart-line"></i> Minhas Estat√≠sticas
                                    </h4>
                                    <div class="stats-grid">
                                        <div class="stat-card">
                                            <div class="stat-value" id="profilePosts">0</div>
                                            <div class="stat-label">Postagens Criadas</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="profileMessages">0</div>
                                            <div class="stat-label">Mensagens Enviadas</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="profileConnections">0</div>
                                            <div class="stat-label">Conex√µes Feitas</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="profileRating">5.0</div>
                                            <div class="stat-label">Avalia√ß√£o M√©dia</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Reviews Page -->
                        <section id="reviewsPage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-star"></i> Minhas Avalia√ß√µes
                                </h2>
                                <div class="rating-stars" style="font-size: 1.5rem;">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span class="rating-value">5.0</span>
                                </div>
                            </div>
                            
                            <div class="admin-panel">
                                <div class="mb-4">
                                    <h4 class="text-primary mb-3">Avalia√ß√µes Recebidas</h4>
                                    <div id="receivedReviews">
                                        <!-- Reviews received will be loaded here -->
                                    </div>
                                    <div class="empty-state" id="emptyReceivedReviews">
                                        <div class="empty-state-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <h3 class="text-primary mb-2">Nenhuma avalia√ß√£o recebida</h3>
                                        <p class="text-muted">Complete conex√µes para receber avalia√ß√µes</p>
                                    </div>
                                </div>
                                
                                <div class="pt-4 border-top">
                                    <h4 class="text-primary mb-3">Avalia√ß√µes Enviadas</h4>
                                    <div id="sentReviews">
                                        <!-- Reviews sent will be loaded here -->
                                    </div>
                                    <div class="empty-state" id="emptySentReviews">
                                        <div class="empty-state-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <h3 class="text-primary mb-2">Nenhuma avalia√ß√£o enviada</h3>
                                        <p class="text-muted">Avalie outras pessoas ap√≥s completar conex√µes</p>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-top">
                                    <h4 class="text-primary mb-3">Como funciona o sistema de reputa√ß√£o?</h4>
                                    <div class="alert alert-info">
                                        <div class="d-flex align-center gap-1">
                                            <i class="fas fa-info-circle"></i>
                                            <div>
                                                <strong>Sistema Bidirecional</strong>
                                                <p class="mb-1">Ap√≥s uma conex√£o bem-sucedida, ambos os usu√°rios podem se avaliar mutuamente.</p>
                                                <p class="mb-0">A reputa√ß√£o √© calculada pela m√©dia das √∫ltimas 50 avalia√ß√µes recebidas.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- My Posts Page -->
                        <section id="myPostsPage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-newspaper"></i> Minhas Postagens
                                </h2>
                                <button class="btn btn-primary btn-small" id="newPostFromProfileBtn">
                                    <i class="fas fa-plus"></i> Nova Postagem
                                </button>
                            </div>
                            
                            <div class="admin-panel">
                                <div class="mb-3">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="searchMyPosts" placeholder="Buscar nas minhas postagens...">
                                        <button class="btn btn-secondary" id="clearSearchPosts">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="posts-grid" id="myPostsGrid">
                                    <!-- My posts will be loaded here -->
                                </div>
                                
                                <div class="empty-state" id="emptyMyPosts">
                                    <div class="empty-state-icon">
                                        <i class="fas fa-newspaper"></i>
                                    </div>
                                    <h3 class="text-primary mb-2">Nenhuma postagem encontrada</h3>
                                    <p class="text-muted">Crie sua primeira postagem para aparecer aqui</p>
                                </div>
                                
                                <div class="mt-4 pt-4 border-top">
                                    <h4 class="text-primary mb-3">
                                        <i class="fas fa-edit"></i> Gerenciar Postagem Existente
                                    </h4>
                                    
                                    <div class="alert alert-warning">
                                        <div class="d-flex align-center gap-1">
                                            <i class="fas fa-key"></i>
                                            <div>
                                                <strong>Use seu c√≥digo de edi√ß√£o</strong>
                                                <p class="mb-1">Digite abaixo o c√≥digo de edi√ß√£o que recebeu ao criar a postagem</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <input type="text" class="form-control" id="editCodeInput" 
                                               placeholder="Digite o c√≥digo de edi√ß√£o (ex: USER-XXXX)">
                                        <button class="btn btn-primary" id="loadPostByCodeBtn">
                                            <i class="fas fa-search"></i> Carregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Admin Page -->
                        <section id="adminPage" class="page-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-shield-alt"></i> Painel de Administra√ß√£o
                                </h2>
                                <button class="btn btn-danger btn-small" id="resetSystemBtn">
                                    <i class="fas fa-trash"></i> Limpar Sistema
                                </button>
                            </div>
                            
                            <div class="admin-panel">
                                <div class="admin-stats">
                                    <div class="admin-stat">
                                        <div class="stat-value" id="adminTotalPosts">0</div>
                                        <div class="stat-label">Total de Propostas</div>
                                    </div>
                                    <div class="admin-stat">
                                        <div class="stat-value" id="adminTotalUsers">0</div>
                                        <div class="stat-label">Usu√°rios Registrados</div>
                                    </div>
                                    <div class="admin-stat">
                                        <div class="stat-value" id="adminActiveConversations">0</div>
                                        <div class="stat-label">Conversas Ativas</div>
                                    </div>
                                    <div class="admin-stat">
                                        <div class="stat-value" id="adminTotalReviews">0</div>
                                        <div class="stat-label">Avalia√ß√µes</div>
                                    </div>
                                </div>
                                
                                <h3 class="text-primary mb-2">
                                    <i class="fas fa-users"></i> Usu√°rios Recentes
                                </h3>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>C√≥digo</th>
                                            <th>Nome</th>
                                            <th>Localiza√ß√£o</th>
                                            <th>Reputa√ß√£o</th>
                                            <th>Avalia√ß√µes</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminUsersTable">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                                
                                <h3 class="text-primary mt-3 mb-2">
                                    <i class="fas fa-flag"></i> Den√∫ncias Recentes
                                </h3>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Usu√°rio</th>
                                            <th>Motivo</th>
                                            <th>Data</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminReportsTable">
                                        <!-- Reports will be loaded here -->
                                    </tbody>
                                </table>
                                
                                <h3 class="text-primary mt-3 mb-2">
                                    <i class="fas fa-cog"></i> Configura√ß√µes do Sistema
                                </h3>
                                <div class="d-flex flex-column gap-2">
                                    <label class="d-flex align-center gap-1">
                                        <input type="checkbox" id="autoModeration" checked>
                                        <span>Modera√ß√£o autom√°tica de conte√∫do</span>
                                    </label>
                                    <label class="d-flex align-center gap-1">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span>Notifica√ß√µes por e-mail</span>
                                    </label>
                                    <label class="d-flex align-center gap-1">
                                        <input type="checkbox" id="gpsRequired" checked disabled>
                                        <span>GPS obrigat√≥rio (sistema)</span>
                                    </label>
                                    <label class="d-flex align-center gap-1">
                                        <input type="checkbox" id="ratingSystem" checked>
                                        <span>Sistema de avalia√ß√£o</span>
                                    </label>
                                    <button class="btn btn-success mt-2" id="saveSettingsBtn">
                                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Install Prompt -->
        <div class="install-prompt d-none" id="installPrompt">
            <div class="notification-icon">
                <i class="fas fa-download"></i>
            </div>
            <div style="flex: 1;">
                <div style="font-weight: 600;">Instalar SYNTA 2.0</div>
                <div style="font-size: 0.875rem; color: var(--gray-600);">
                    Adicione √† tela inicial para acesso r√°pido, mesmo offline
                </div>
            </div>
            <button class="btn btn-primary btn-small" id="installBtn">
                Instalar
            </button>
            <button class="btn btn-outline btn-small" id="dismissInstall">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Notification -->
        <div class="notification d-none" id="notification">
            <div class="notification-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div>
                <div style="font-weight: 600;" id="notificationTitle">Informa√ß√£o</div>
                <div style="font-size: 0.875rem;" id="notificationMessage">
                    Mensagem de notifica√ß√£o
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Create Post Modal -->
    <div class="modal-overlay" id="createPostModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-plus-circle"></i> Nova Proposta
                </h3>
                <button class="modal-close" id="closePostModal">&times;</button>
            </div>
            
            <form id="postForm">
                <div class="alert alert-info">
                    <div class="d-flex align-center gap-1">
                        <i class="fas fa-satellite"></i>
                        <div>
                            <strong>Sua localiza√ß√£o atual ser√° usada</strong>
                            <p class="mb-0">Postagem vis√≠vel apenas para usu√°rios dentro de 50km</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">T√≠tulo * (max 100 caracteres)</label>
                    <input type="text" class="form-control" id="postTitle" 
                           placeholder="Ex: Procuro parceiro para projeto" required
                           maxlength="100">
                    <div class="form-hint" id="titleCounter">0/100 caracteres</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Categoria *</label>
                    <select class="form-control" id="postCategory" required>
                        <option value="">Selecione uma categoria</option>
                        <option value="friendship">Amizade</option>
                        <option value="business">Neg√≥cios</option>
                        <option value="services">Servi√ßos</option>
                        <option value="events">Eventos</option>
                        <option value="ideas">Ideias Inusitadas</option>
                        <option value="learning">Aprendizado</option>
                        <option value="sports">Esportes</option>
                        <option value="music">M√∫sica</option>
                        <option value="travel">Viagens</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o * (max 500 caracteres)</label>
                    <textarea class="form-control" id="postDescription" rows="4" 
                              placeholder="Descreva sua proposta em detalhes..." 
                              required maxlength="500"></textarea>
                    <div class="form-hint" id="descCounter">0/500 caracteres</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email para contato (opcional)</label>
                    <input type="email" class="form-control" id="postEmail" 
                           placeholder="seu@email.com (n√£o ser√° exibido publicamente)">
                    <div class="form-hint">Receba notifica√ß√µes quando algu√©m enviar proposta</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Localiza√ß√£o *</label>
                    <input type="text" class="form-control" id="postLocation" 
                           placeholder="Carregando sua localiza√ß√£o..." required readonly>
                    <div class="form-hint" id="locationAccuracy">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Usando sua localiza√ß√£o atual via GPS</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Anonimato</label>
                    <div class="d-flex flex-column gap-1">
                        <label class="d-flex align-center gap-1">
                            <input type="radio" name="anonymity" value="full" checked>
                            <span>Total (apenas c√≥digo SYNTA vis√≠vel)</span>
                        </label>
                        <label class="d-flex align-center gap-1">
                            <input type="radio" name="anonymity" value="partial">
                            <span>Parcial (c√≥digo e nome de exibi√ß√£o)</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dura√ß√£o da Proposta</label>
                    <select class="form-control" id="postDuration">
                        <option value="7">7 dias</option>
                        <option value="14" selected>14 dias</option>
                        <option value="30">30 dias</option>
                        <option value="90">3 meses</option>
                    </select>
                </div>
                
                <div class="alert alert-success">
                    <div class="d-flex align-center gap-1">
                        <i class="fas fa-key"></i>
                        <div>
                            <strong>Seu c√≥digo de edi√ß√£o ser√° gerado</strong>
                            <p class="mb-0">Guarde-o para editar ou excluir sua postagem posteriormente</p>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-secondary" id="cancelPostBtn">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Publicar Proposta
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- View Post Modal -->
    <div class="modal-overlay" id="viewPostModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="viewPostTitle">Carregando...</h3>
                <button class="modal-close" id="closeViewModal">&times;</button>
            </div>
            
            <div id="viewPostContent">
                <!-- Post content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Edit Post Modal -->
    <div class="modal-overlay" id="editPostModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-edit"></i> Editar Postagem
                </h3>
                <button class="modal-close" id="closeEditModal">&times;</button>
            </div>
            
            <div id="editPostContent">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Post Codes Modal -->
    <div class="modal-overlay" id="postCodesModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-key"></i> C√≥digos Gerados
                </h3>
                <button class="modal-close" id="closeCodesModal">&times;</button>
            </div>
            
            <div id="postCodesContent">
                <!-- Post codes will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Rating Modal -->
    <div class="modal-overlay" id="ratingModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-star"></i> Avaliar Usu√°rio
                </h3>
                <button class="modal-close" id="closeRatingModal">&times;</button>
            </div>
            
            <div id="ratingContent">
                <!-- Rating form will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-flag"></i> Denunciar Usu√°rio
                </h3>
                <button class="modal-close" id="closeReportModal">&times;</button>
            </div>
            
            <div id="reportContent">
                <!-- Report form will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="modal-overlay" id="loadingOverlay">
        <div class="modal" style="background: transparent; box-shadow: none; text-align: center;">
            <div class="loading-spinner"></div>
            <p style="color: white; margin-top: 1rem;" id="loadingText">Carregando...</p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // ============================================
        // SYNTA 2.0 - Sistema Completo com Avalia√ß√£o Bidirecional
        // Vers√£o: 2.0.0
        // Data: 2024
        // ============================================
        
        const SYNTA = {
            // Configura√ß√µes
            config: {
                appName: 'SYNTA 2.0',
                version: '2.0.0',
                storageKey: 'syntax_v2_data',
                defaultRadius: 50, // km
                adminCode: 'SYNTA-ADMIN',
                maxDistance: 50, // km m√°ximo para mostrar posts
                
                // Categorias
                categories: [
                    { id: 'friendship', name: 'Amizade', icon: 'fa-user-friends', color: '#10b981' },
                    { id: 'business', name: 'Neg√≥cios', icon: 'fa-briefcase', color: '#3b82f6' },
                    { id: 'services', name: 'Servi√ßos', icon: 'fa-tools', color: '#f59e0b' },
                    { id: 'events', name: 'Eventos', icon: 'fa-calendar-alt', color: '#ef4444' },
                    { id: 'ideas', name: 'Ideias Inusitadas', icon: 'fa-lightbulb', color: '#8b5cf6' },
                    { id: 'learning', name: 'Aprendizado', icon: 'fa-graduation-cap', color: '#06b6d4' },
                    { id: 'sports', name: 'Esportes', icon: 'fa-futbol', color: '#84cc16' },
                    { id: 'music', name: 'M√∫sica', icon: 'fa-music', color: '#ec4899' },
                    { id: 'travel', name: 'Viagens', icon: 'fa-plane', color: '#f97316' },
                    { id: 'other', name: 'Outros', icon: 'fa-ellipsis-h', color: '#94a3b8' }
                ],
                
                // Tipos de c√≥digos
                codeFormats: {
                    user: /^SYNTA-[A-Z0-9]{6}$/,
                    post: /^POST[A-Z]-[0-9]{4}$/,
                    entry: /^USER-[A-Z0-9]{4}$/
                },
                
                // Geradores de c√≥digos
                codeGenerators: {
                    userCode: () => 'SYNTA-' + Math.random().toString(36).substring(2, 8).toUpperCase(),
                    postCode: () => {
                        const letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                        const numbers = Math.floor(1000 + Math.random() * 9000);
                        return `POST${letter}-${numbers}`;
                    },
                    entryCode: () => 'USER-' + Math.random().toString(36).substring(2, 6).toUpperCase()
                },
                
                // Palavras proibidas
                bannedWords: [
                    'xxx', 'porn', 'sex', 'drug', 'weapon', 'hate', 'scam', 'fraud',
                    'spam', 'viagra', 'casino', 'gambling', 'racist', 'violence',
                    'assassin', 'kill', 'murder', 'terrorist', 'bomb'
                ],
                
                // Motivos de den√∫ncia
                reportReasons: [
                    'Conte√∫do inadequado',
                    'Comportamento ofensivo',
                    'Spam ou propaganda',
                    'Informa√ß√£o falsa',
                    'Ass√©dio',
                    'Outro motivo'
                ]
            },
            
            // Estado da aplica√ß√£o
            state: {
                currentUser: null,
                currentPage: 'feed',
                userLocation: null,
                map: null,
                posts: [],
                conversations: [],
                users: {},
                ratings: [],
                reports: [],
                selectedPost: null,
                selectedConversation: null,
                deferredPrompt: null,
                isAdmin: false,
                gpsStatus: 'checking',
                ratingInProgress: false
            },
            
            // Inicializa√ß√£o
            async init() {
                console.log(`${this.config.appName} v${this.config.version} inicializando...`);
                
                // Configurar GPS obrigat√≥rio
                await this.enforceGPS();
                
                // Configurar eventos
                this.setupEventListeners();
                
                // Carregar dados
                this.loadFromStorage();
                
                // Verificar PWA
                this.checkPWAInstall();
                
                // Atualizar UI
                this.updateUI();
                
                // Mostrar tela apropriada
                if (this.state.currentUser) {
                    this.showDashboard();
                }
                
                console.log('Sistema inicializado com sucesso!');
            },
            
            // ============================================
            // SISTEMA DE GPS OBRIGAT√ìRIO
            // ============================================
            
            async enforceGPS() {
                return new Promise((resolve, reject) => {
                    if (!('geolocation' in navigator)) {
                        this.showNotification('GPS n√£o dispon√≠vel neste dispositivo', 'error');
                        document.getElementById('accessSubmit').disabled = true;
                        document.getElementById('locationStatus').innerHTML = `
                            <i class="fas fa-times-circle"></i> GPS n√£o dispon√≠vel - App n√£o funcionar√°
                        `;
                        reject(new Error('GPS n√£o dispon√≠vel'));
                        return;
                    }
                    
                    const options = {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 0
                    };
                    
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.state.userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy,
                                timestamp: Date.now()
                            };
                            
                            this.state.gpsStatus = 'active';
                            
                            // Atualizar UI
                            document.getElementById('locationStatus').innerHTML = `
                                <i class="fas fa-check-circle"></i> GPS ativo (precis√£o: ${Math.round(this.state.userLocation.accuracy)}m)
                            `;
                            document.getElementById('accessSubmit').disabled = false;
                            document.getElementById('gpsAccuracy').textContent = Math.round(this.state.userLocation.accuracy);
                            
                            // Atualizar status GPS na sidebar
                            const gpsSidebar = document.getElementById('gpsSidebarStatus');
                            if (gpsSidebar) {
                                gpsSidebar.className = 'gps-indicator gps-active';
                                gpsSidebar.innerHTML = `
                                    <i class="fas fa-check-circle"></i>
                                    <span>GPS Ativo</span>
                                `;
                            }
                            
                            this.showNotification('Localiza√ß√£o obtida com sucesso', 'success');
                            resolve(this.state.userLocation);
                        },
                        (error) => {
                            this.state.gpsStatus = 'inactive';
                            let message = 'GPS obrigat√≥rio para usar o app';
                            
                            switch(error.code) {
                                case 1: 
                                    message = 'Permiss√£o de localiza√ß√£o negada';
                                    break;
                                case 2: 
                                    message = 'Localiza√ß√£o indispon√≠vel';
                                    break;
                                case 3: 
                                    message = 'Tempo esgotado ao obter localiza√ß√£o';
                                    break;
                            }
                            
                            document.getElementById('locationStatus').innerHTML = `
                                <i class="fas fa-times-circle"></i> ${message}
                            `;
                            document.getElementById('accessSubmit').disabled = true;
                            
                            // Bloquear completamente se GPS n√£o funcionar
                            this.showNotification(message + '. Ative o GPS para continuar.', 'error');
                            reject(error);
                        },
                        options
                    );
                });
            },
            
            // ============================================
            // SISTEMA DE C√ìDIGOS TR√çPLICES
            // ============================================
            
            validateCode(code, type = 'user') {
                const patterns = {
                    user: this.config.codeFormats.user,
                    post: this.config.codeFormats.post,
                    entry: this.config.codeFormats.entry
                };
                
                return patterns[type] ? patterns[type].test(code) : false;
            },
            
            generateCode(type = 'user') {
                const generators = {
                    user: this.config.codeGenerators.userCode,
                    post: this.config.codeGenerators.postCode,
                    entry: this.config.codeGenerators.entryCode
                };
                
                return generators[type] ? generators[type]() : null;
            },
            
            // ============================================
            // SISTEMA DE AVALIA√á√ÉO BIDIRECIONAL
            // ============================================
            
            // Calcular reputa√ß√£o do usu√°rio
            calculateUserRating(userCode) {
                const userRatings = this.state.ratings.filter(r => r.toUser === userCode);
                
                if (userRatings.length === 0) {
                    return {
                        average: 5.0,
                        count: 0,
                        ratings: []
                    };
                }
                
                const total = userRatings.reduce((sum, rating) => sum + rating.rating, 0);
                const average = total / userRatings.length;
                
                // Pegar apenas as √∫ltimas 50 avalia√ß√µes para reputa√ß√£o
                const recentRatings = userRatings
                    .sort((a, b) => b.createdAt - a.createdAt)
                    .slice(0, 50);
                
                const recentAverage = recentRatings.length > 0 
                    ? recentRatings.reduce((sum, r) => sum + r.rating, 0) / recentRatings.length
                    : average;
                
                return {
                    average: parseFloat(recentAverage.toFixed(1)),
                    count: userRatings.length,
                    ratings: userRatings.sort((a, b) => b.createdAt - a.createdAt)
                };
            },
            
            // Verificar se usu√°rio j√° avaliou uma conversa
            hasRatedConversation(conversationId, raterCode) {
                return this.state.ratings.some(r => 
                    r.conversationId === conversationId && 
                    r.fromUser === raterCode
                );
            },
            
            // Mostrar modal de avalia√ß√£o
            showRatingModal(conversationId, rateeCode) {
                if (!this.state.currentUser) return;
                
                const conversation = this.state.conversations.find(c => c.id === conversationId);
                const rateeUser = this.state.users[rateeCode] || { name: 'Usu√°rio SYNTA' };
                
                // Verificar se j√° avaliou
                if (this.hasRatedConversation(conversationId, this.state.currentUser.code)) {
                    this.showNotification('Voc√™ j√° avaliou esta conversa', 'info');
                    return;
                }
                
                let currentRating = 5;
                
                const content = `
                    <div class="text-center mb-4">
                        <div class="user-avatar" style="width: 80px; height: 80px; margin: 0 auto 1rem;">
                            ${rateeUser.avatar ? 
                                `<img src="${this.escapeHtml(rateeUser.avatar)}" alt="${this.escapeHtml(rateeUser.name)}">` :
                                rateeUser.name.charAt(0)
                            }
                        </div>
                        <h4 class="text-primary mb-1">Avaliar ${this.escapeHtml(rateeUser.name)}</h4>
                        <p class="text-muted">Como foi sua experi√™ncia com esta conex√£o?</p>
                    </div>
                    
                    <div class="rating-stars mb-4" id="ratingStars">
                        <i class="fas fa-star star ${currentRating >= 1 ? 'selected' : ''}" data-value="1"></i>
                        <i class="fas fa-star star ${currentRating >= 2 ? 'selected' : ''}" data-value="2"></i>
                        <i class="fas fa-star star ${currentRating >= 3 ? 'selected' : ''}" data-value="3"></i>
                        <i class="fas fa-star star ${currentRating >= 4 ? 'selected' : ''}" data-value="4"></i>
                        <i class="fas fa-star star ${currentRating >= 5 ? 'selected' : ''}" data-value="5"></i>
                        <span class="rating-value">${currentRating}.0</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Coment√°rio (opcional)</label>
                        <textarea class="form-control" id="ratingComment" rows="3" 
                                  placeholder="Deixe um coment√°rio sobre sua experi√™ncia... (m√°x. 300 caracteres)"
                                  maxlength="300"></textarea>
                        <div class="form-hint" id="commentCounter">0/300 caracteres</div>
                    </div>
                    
                    <div class="alert alert-info mb-4">
                        <div class="d-flex align-center gap-1">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Avalia√ß√£o an√¥nima</strong>
                                <p class="mb-0">Sua avalia√ß√£o ser√° an√¥nima. O usu√°rio ver√° apenas a nota e coment√°rio.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-secondary" id="cancelRatingBtn">
                            Cancelar
                        </button>
                        <button type="button" class="btn btn-primary" id="submitRatingBtn">
                            <i class="fas fa-star"></i> Enviar Avalia√ß√£o
                        </button>
                    </div>
                `;
                
                document.getElementById('ratingContent').innerHTML = content;
                
                // Configurar estrelas interativas
                const stars = document.querySelectorAll('#ratingStars .star');
                const ratingValue = document.querySelector('#ratingStars .rating-value');
                
                stars.forEach(star => {
                    star.addEventListener('click', () => {
                        const value = parseInt(star.dataset.value);
                        currentRating = value;
                        
                        stars.forEach((s, index) => {
                            if (index < value) {
                                s.classList.add('selected');
                            } else {
                                s.classList.remove('selected');
                            }
                        });
                        
                        ratingValue.textContent = `${value}.0`;
                    });
                    
                    star.addEventListener('mouseover', () => {
                        const value = parseInt(star.dataset.value);
                        
                        stars.forEach((s, index) => {
                            if (index < value) {
                                s.classList.add('hover');
                            } else {
                                s.classList.remove('hover');
                            }
                        });
                    });
                    
                    star.addEventListener('mouseout', () => {
                        stars.forEach(s => s.classList.remove('hover'));
                        
                        // Restaurar sele√ß√£o atual
                        stars.forEach((s, index) => {
                            if (index < currentRating) {
                                s.classList.add('selected');
                            } else {
                                s.classList.remove('selected');
                            }
                        });
                    });
                });
                
                // Contador de caracteres
                const commentInput = document.getElementById('ratingComment');
                const commentCounter = document.getElementById('commentCounter');
                
                commentInput.addEventListener('input', () => {
                    commentCounter.textContent = `${commentInput.value.length}/300 caracteres`;
                });
                
                // Event listeners dos bot√µes
                document.getElementById('cancelRatingBtn').addEventListener('click', () => {
                    this.hideModal('ratingModal');
                });
                
                document.getElementById('submitRatingBtn').addEventListener('click', () => {
                    this.submitRating(conversationId, rateeCode, currentRating, commentInput.value.trim());
                });
                
                this.showModal('ratingModal');
            },
            
            // Enviar avalia√ß√£o
            submitRating(conversationId, rateeCode, rating, comment) {
                if (!this.state.currentUser || this.state.ratingInProgress) return;
                
                this.state.ratingInProgress = true;
                
                // Criar avalia√ß√£o
                const ratingData = {
                    id: this.generateId(),
                    fromUser: this.state.currentUser.code,
                    toUser: rateeCode,
                    conversationId: conversationId,
                    rating: rating,
                    comment: comment || null,
                    createdAt: Date.now(),
                    anonymous: true
                };
                
                // Adicionar ao array de avalia√ß√µes
                this.state.ratings.push(ratingData);
                
                // Atualizar reputa√ß√£o do usu√°rio avaliado
                const userRating = this.calculateUserRating(rateeCode);
                this.state.users[rateeCode].reputation = Math.round(userRating.average * 20); // Converter para 0-100
                
                // Atualizar estat√≠sticas
                this.state.currentUser.stats.reviewsGiven = (this.state.currentUser.stats.reviewsGiven || 0) + 1;
                
                // Salvar
                this.saveToStorage();
                
                // Fechar modal
                this.hideModal('ratingModal');
                
                // Mostrar confirma√ß√£o
                this.showNotification('Avalia√ß√£o enviada com sucesso!', 'success');
                
                // Atualizar UI
                this.updateUI();
                
                // Se estiver na p√°gina de chat, atualizar o bot√£o
                if (this.state.currentPage === 'chat') {
                    this.updateChatRatingButton();
                }
                
                this.state.ratingInProgress = false;
            },
            
            // Atualizar bot√£o de avalia√ß√£o no chat
            updateChatRatingButton() {
                if (!this.state.selectedConversation || !this.state.currentUser) return;
                
                const acceptBtn = document.getElementById('acceptProposalBtn');
                const conversation = this.state.selectedConversation;
                const otherUser = conversation.participants.find(p => p !== this.state.currentUser.code);
                
                if (!otherUser) return;
                
                // Verificar se j√° avaliou esta conversa
                if (this.hasRatedConversation(conversation.id, this.state.currentUser.code)) {
                    acceptBtn.innerHTML = '<i class="fas fa-check-circle"></i> J√° Avaliado';
                    acceptBtn.disabled = true;
                    acceptBtn.classList.remove('btn-success');
                    acceptBtn.classList.add('btn-secondary');
                } else {
                    acceptBtn.innerHTML = '<i class="fas fa-handshake"></i> Proposta Aceita';
                    acceptBtn.disabled = false;
                    acceptBtn.classList.remove('btn-secondary');
                    acceptBtn.classList.add('btn-success');
                    
                    // Reconfigurar evento de clique
                    acceptBtn.onclick = () => {
                        this.showRatingModal(conversation.id, otherUser);
                    };
                }
            },
            
            // ============================================
            // SISTEMA DE POSTS COM FILTRO DE 50KM
            // ============================================
            
            // Carregar posts com filtro de dist√¢ncia
            loadPosts() {
                const container = document.getElementById('postsGrid');
                const emptyState = document.getElementById('emptyFeed');
                
                // Filtrar posts expirados
                this.state.posts = this.state.posts.filter(post => {
                    return post.status === 'active' && post.expiresAt > Date.now();
                });
                
                // Se temos localiza√ß√£o do usu√°rio, filtrar por 50km
                let filteredPosts = [...this.state.posts];
                
                if (this.state.userLocation && this.state.userLocation.lat) {
                    filteredPosts = filteredPosts.filter(post => {
                        if (!post.location || !post.location.lat) return false;
                        
                        const distance = this.calculateDistance(
                            this.state.userLocation.lat,
                            this.state.userLocation.lng,
                            post.location.lat,
                            post.location.lng
                        );
                        
                        post.distance = distance; // Atualizar dist√¢ncia
                        return distance <= this.config.maxDistance; // Apenas dentro de 50km
                    });
                    
                    // Ordenar por mais pr√≥ximo ‚Üí mais distante por padr√£o
                    filteredPosts.sort((a, b) => (a.distance || 999) - (b.distance || 999));
                }
                
                if (filteredPosts.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('d-none');
                    
                    // Mostrar mensagem espec√≠fica
                    if (this.state.userLocation) {
                        document.querySelector('#emptyFeed h3').textContent = 
                            'Nenhuma proposta dentro de 50km';
                    }
                    return;
                }
                
                emptyState.classList.add('d-none');
                
                let html = '';
                
                filteredPosts.forEach(post => {
                    const category = this.config.categories.find(c => c.id === post.category);
                    const timeAgo = this.formatTime(post.createdAt);
                    const authorName = post.anonymity === 'full' ? 'Usu√°rio SYNTA' : post.authorName;
                    const authorRating = this.calculateUserRating(post.author);
                    
                    html += `
                        <div class="post-card" data-post-id="${post.id}">
                            <div class="post-header">
                                <span class="post-category" style="background: ${category.color}20; color: ${category.color};">
                                    <i class="fas ${category.icon}"></i> ${category.name}
                                </span>
                                <h3 class="post-title">${this.escapeHtml(post.title)}</h3>
                                <p class="post-description">${this.escapeHtml(post.description)}</p>
                                <div class="d-flex align-center justify-between mt-2">
                                    <div>
                                        <span class="text-muted" style="font-size: 0.875rem;">
                                            <i class="fas fa-user"></i> ${this.escapeHtml(authorName)}
                                        </span>
                                        <div class="rating-stars" style="font-size: 0.75rem; margin-top: 0.25rem;">
                                            <i class="fas fa-star ${authorRating.average >= 1 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 2 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 3 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 4 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 5 ? 'selected' : ''}"></i>
                                            <span style="font-size: 0.75rem; color: var(--gray-500); margin-left: 0.25rem;">
                                                ${authorRating.average.toFixed(1)}
                                            </span>
                                        </div>
                                    </div>
                                    ${post.email ? `
                                        <span class="text-muted" style="font-size: 0.875rem;">
                                            <i class="fas fa-envelope"></i> Contato por email
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="post-footer">
                                <div class="post-meta">
                                    <span class="post-distance">
                                        <i class="fas fa-map-marker-alt"></i>
                                        ${post.distance ? `${post.distance.toFixed(1)}km` : '‚Äî'}
                                    </span>
                                    <span><i class="far fa-clock"></i> ${timeAgo}</span>
                                    <span><i class="fas fa-comment"></i> ${post.proposals || 0}</span>
                                    <span><i class="fas fa-hashtag"></i> ${post.postCode || 'POST-XXXX'}</span>
                                </div>
                                <button class="btn btn-primary btn-small view-post-btn" data-id="${post.id}">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Adicionar event listeners
                document.querySelectorAll('.view-post-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.id;
                        this.viewPost(postId);
                    });
                });
            },
            
            // Filtrar posts
            filterPosts(filter) {
                const container = document.getElementById('postsGrid');
                const emptyState = document.getElementById('emptyFeed');
                
                let filteredPosts = [...this.state.posts].filter(post => 
                    post.status === 'active' && post.expiresAt > Date.now()
                );
                
                // Aplicar filtro de dist√¢ncia primeiro
                if (this.state.userLocation && this.state.userLocation.lat) {
                    filteredPosts = filteredPosts.filter(post => {
                        if (!post.location || !post.location.lat) return false;
                        
                        const distance = this.calculateDistance(
                            this.state.userLocation.lat,
                            this.state.userLocation.lng,
                            post.location.lat,
                            post.location.lng
                        );
                        
                        post.distance = distance;
                        return distance <= this.config.maxDistance;
                    });
                }
                
                // Aplicar ordena√ß√£o
                switch(filter) {
                    case 'nearby':
                        // J√° ordenado por dist√¢ncia
                        break;
                    case 'trending':
                        // Ordenar por n√∫mero de propostas
                        filteredPosts.sort((a, b) => (b.proposals || 0) - (a.proposals || 0));
                        break;
                    case 'newest':
                        // Ordenar por data
                        filteredPosts.sort((a, b) => b.createdAt - a.createdAt);
                        break;
                }
                
                if (filteredPosts.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('d-none');
                    return;
                }
                
                emptyState.classList.add('d-none');
                
                let html = '';
                
                filteredPosts.forEach(post => {
                    const category = this.config.categories.find(c => c.id === post.category);
                    const timeAgo = this.formatTime(post.createdAt);
                    const authorName = post.anonymity === 'full' ? 'Usu√°rio SYNTA' : post.authorName;
                    const authorRating = this.calculateUserRating(post.author);
                    
                    html += `
                        <div class="post-card" data-post-id="${post.id}">
                            <div class="post-header">
                                <span class="post-category" style="background: ${category.color}20; color: ${category.color};">
                                    <i class="fas ${category.icon}"></i> ${category.name}
                                </span>
                                <h3 class="post-title">${this.escapeHtml(post.title)}</h3>
                                <p class="post-description">${this.escapeHtml(post.description)}</p>
                                <div class="d-flex align-center justify-between mt-2">
                                    <div>
                                        <span class="text-muted" style="font-size: 0.875rem;">
                                            <i class="fas fa-user"></i> ${this.escapeHtml(authorName)}
                                        </span>
                                        <div class="rating-stars" style="font-size: 0.75rem; margin-top: 0.25rem;">
                                            <i class="fas fa-star ${authorRating.average >= 1 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 2 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 3 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 4 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${authorRating.average >= 5 ? 'selected' : ''}"></i>
                                            <span style="font-size: 0.75rem; color: var(--gray-500); margin-left: 0.25rem;">
                                                ${authorRating.average.toFixed(1)}
                                            </span>
                                        </div>
                                    </div>
                                    ${post.email ? `
                                        <span class="text-muted" style="font-size: 0.875rem;">
                                            <i class="fas fa-envelope"></i> Contato por email
                                        </span>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="post-footer">
                                <div class="post-meta">
                                    <span class="post-distance">
                                        <i class="fas fa-map-marker-alt"></i>
                                        ${post.distance ? `${post.distance.toFixed(1)}km` : '‚Äî'}
                                    </span>
                                    <span><i class="far fa-clock"></i> ${timeAgo}</span>
                                    <span><i class="fas fa-comment"></i> ${post.proposals || 0}</span>
                                    <span><i class="fas fa-hashtag"></i> ${post.postCode || 'POST-XXXX'}</span>
                                </div>
                                <button class="btn btn-primary btn-small view-post-btn" data-id="${post.id}">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Adicionar event listeners
                document.querySelectorAll('.view-post-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.id;
                        this.viewPost(postId);
                    });
                });
            },
            
            // ============================================
            // SISTEMA DE POSTAGEM COMPLETO
            // ============================================
            
            async createPost() {
                const title = document.getElementById('postTitle').value.trim();
                const description = document.getElementById('postDescription').value.trim();
                const locationInput = document.getElementById('postLocation').value.trim();
                const category = document.getElementById('postCategory').value;
                const email = document.getElementById('postEmail').value.trim();
                const anonymity = document.querySelector('input[name="anonymity"]:checked').value;
                const duration = parseInt(document.getElementById('postDuration').value);
                
                // Valida√ß√µes
                if (!title || !description || !locationInput || !category) {
                    this.showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                    return;
                }
                
                if (title.length > 100) {
                    this.showNotification('T√≠tulo muito longo (max 100 caracteres)', 'error');
                    return;
                }
                
                if (description.length > 500) {
                    this.showNotification('Descri√ß√£o muito longa (max 500 caracteres)', 'error');
                    return;
                }
                
                if (this.containsBannedWords(title + ' ' + description)) {
                    this.showNotification('O conte√∫do cont√©m palavras n√£o permitidas', 'error');
                    return;
                }
                
                // Validar email se fornecido
                if (email && !this.validateEmail(email)) {
                    this.showNotification('Email inv√°lido', 'error');
                    return;
                }
                
                // Verificar se temos localiza√ß√£o GPS
                if (!this.state.userLocation) {
                    this.showNotification('GPS necess√°rio para criar post', 'error');
                    return;
                }
                
                // Obter nome da cidade
                const cityName = await this.getCityName(this.state.userLocation.lat, this.state.userLocation.lng);
                
                // Usar localiza√ß√£o GPS
                const locationData = {
                    lat: this.state.userLocation.lat,
                    lng: this.state.userLocation.lng,
                    city: cityName,
                    displayName: locationInput,
                    accuracy: this.state.userLocation.accuracy
                };
                
                // Gerar c√≥digos
                const postCode = this.generateCode('post');
                const entryCode = this.generateCode('entry');
                
                // Criar post
                const post = {
                    id: this.generateId(),
                    postCode: postCode,
                    entryCode: entryCode,
                    title: title,
                    description: description,
                    category: category,
                    location: locationData,
                    author: this.state.currentUser.code,
                    authorName: anonymity === 'full' ? null : this.state.currentUser.name,
                    email: email || null,
                    createdAt: Date.now(),
                    expiresAt: Date.now() + (duration * 24 * 3600000),
                    proposals: 0,
                    anonymity: anonymity,
                    status: 'active',
                    isPublic: true,
                    views: 0
                };
                
                // Calcular dist√¢ncia (ser√° 0 para o pr√≥prio usu√°rio)
                post.distance = 0;
                
                // Adicionar √† lista
                this.state.posts.unshift(post);
                
                // Atualizar estat√≠sticas
                this.state.currentUser.stats.posts = (this.state.currentUser.stats.posts || 0) + 1;
                this.state.currentUser.stats.reputation = Math.min(100, (this.state.currentUser.stats.reputation || 100) + 5);
                this.state.users[this.state.currentUser.code].stats = this.state.currentUser.stats;
                
                // Salvar
                this.saveToStorage();
                
                // Fechar modal
                this.hideModal('createPostModal');
                
                // Mostrar c√≥digos ao usu√°rio
                this.showPostCodesModal(postCode, entryCode);
                
                // Atualizar UI
                this.updateUI();
                this.loadPosts();
                this.updateMap();
                
                this.showNotification('Postagem criada com sucesso!', 'success');
            },
            
            // Mostrar modal com c√≥digos gerados
            showPostCodesModal(postCode, entryCode) {
                const content = `
                    <div class="text-center">
                        <div class="mb-4">
                            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--accent);"></i>
                            <h3 class="text-primary mt-2">Postagem Criada com Sucesso!</h3>
                        </div>
                        
                        <div class="mb-4">
                            <div class="alert alert-success">
                                <h4 class="mb-3">Guarde estes c√≥digos:</h4>
                                
                                <div class="mb-3">
                                    <div class="text-muted">C√≥digo da Postagem</div>
                                    <div class="code-display mt-1">
                                        ${postCode}
                                    </div>
                                    <small class="text-muted">Usado para identifica√ß√£o p√∫blica</small>
                                </div>
                                
                                <div>
                                    <div class="text-muted">C√≥digo de Edi√ß√£o (PRIVADO)</div>
                                    <div class="code-display mt-1" style="color: var(--danger); border-color: var(--danger);">
                                        ${entryCode}
                                    </div>
                                    <small class="text-muted">Guarde para editar ou excluir sua postagem</small>
                                </div>
                            </div>
                            
                            <p class="text-muted">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <strong>Importante:</strong> O c√≥digo de edi√ß√£o n√£o pode ser recuperado!
                            </p>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" id="copyCodesBtn">
                                <i class="fas fa-copy"></i> Copiar C√≥digos
                            </button>
                            <button class="btn btn-secondary" id="closeCodesBtn">
                                OK, Entendi
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('postCodesContent').innerHTML = content;
                
                // Adicionar event listeners
                document.getElementById('copyCodesBtn').addEventListener('click', () => {
                    const text = `C√≥digo Postagem: ${postCode}\nC√≥digo Edi√ß√£o: ${entryCode}`;
                    navigator.clipboard.writeText(text);
                    this.showNotification('C√≥digos copiados para a √°rea de transfer√™ncia!', 'success');
                });
                
                document.getElementById('closeCodesBtn').addEventListener('click', () => {
                    this.hideModal('postCodesModal');
                });
                
                this.showModal('postCodesModal');
            },
            
            // ============================================
            // SISTEMA DE CHAT COM AVALIA√á√ÉO
            // ============================================
            
            // Carregar chat
            loadChat() {
                if (!this.state.selectedConversation) {
                    this.showPage('messages');
                    return;
                }
                
                const conversation = this.state.selectedConversation;
                const otherParticipant = conversation.participants.find(p => p !== this.state.currentUser.code);
                const otherUser = this.state.users[otherParticipant] || { name: 'Usu√°rio SYNTA', avatar: null };
                const otherRating = this.calculateUserRating(otherParticipant);
                
                // Atualizar header
                document.getElementById('chatName').textContent = otherUser.name;
                document.getElementById('chatUserRating').textContent = otherRating.average.toFixed(1);
                document.getElementById('chatAvatar').innerHTML = otherUser.avatar ? 
                    `<img src="${this.escapeHtml(otherUser.avatar)}" alt="${this.escapeHtml(otherUser.name)}">` :
                    otherUser.name.charAt(0);
                
                // Atualizar estrelas do rating
                const ratingStars = document.querySelectorAll('.chat-header .fa-star');
                ratingStars.forEach((star, index) => {
                    if (index < Math.floor(otherRating.average)) {
                        star.classList.add('selected');
                    } else {
                        star.classList.remove('selected');
                    }
                });
                
                // Carregar mensagens
                const container = document.getElementById('chatMessages');
                const messages = conversation.messages || [];
                
                let html = '';
                
                messages.forEach(msg => {
                    const isSent = msg.sender === this.state.currentUser.code;
                    const time = new Date(msg.timestamp).toLocaleTimeString([], { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    html += `
                        <div class="message ${isSent ? 'sent' : 'received'}">
                            <div class="message-content">${this.escapeHtml(msg.content)}</div>
                            <div class="message-time">${time}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Habilitar input
                document.getElementById('messageInput').disabled = false;
                document.getElementById('sendMessageBtn').disabled = false;
                document.getElementById('messageInput').focus();
                
                // Atualizar bot√£o de avalia√ß√£o
                this.updateChatRatingButton();
                
                // Configurar bot√£o de den√∫ncia
                document.getElementById('reportUserBtn').onclick = () => {
                    this.showReportModal(otherParticipant, conversation.id);
                };
                
                // Scroll para baixo
                container.scrollTop = container.scrollHeight;
                
                // Marcar como lida
                if (conversation.unread) {
                    conversation.unread = false;
                    this.saveToStorage();
                    this.updateMessageBadge();
                }
            },
            
            // ============================================
            // SISTEMA DE DEN√öNCIAS
            // ============================================
            
            showReportModal(userCode, conversationId) {
                const user = this.state.users[userCode] || { name: 'Usu√°rio SYNTA' };
                
                const content = `
                    <div class="mb-4">
                        <div class="alert alert-warning">
                            <div class="d-flex align-center gap-1">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>
                                    <strong>Denunciar ${this.escapeHtml(user.name)}</strong>
                                    <p class="mb-0">Descreva o motivo da den√∫ncia abaixo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Motivo da Den√∫ncia *</label>
                        <select class="form-control" id="reportReason" required>
                            <option value="">Selecione um motivo</option>
                            ${this.config.reportReasons.map(reason => 
                                `<option value="${reason}">${reason}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o * (m√°x. 500 caracteres)</label>
                        <textarea class="form-control" id="reportDescription" rows="4" 
                                  placeholder="Descreva em detalhes o motivo da den√∫ncia..."
                                  required maxlength="500"></textarea>
                        <div class="form-hint" id="reportCounter">0/500 caracteres</div>
                    </div>
                    
                    <div class="alert alert-info">
                        <div class="d-flex align-center gap-1">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Den√∫ncia an√¥nima</strong>
                                <p class="mb-0">Sua identidade n√£o ser√° revelada ao usu√°rio denunciado.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-secondary" id="cancelReportBtn">
                            Cancelar
                        </button>
                        <button type="button" class="btn btn-danger" id="submitReportBtn">
                            <i class="fas fa-flag"></i> Enviar Den√∫ncia
                        </button>
                    </div>
                `;
                
                document.getElementById('reportContent').innerHTML = content;
                
                // Contador de caracteres
                const descInput = document.getElementById('reportDescription');
                const descCounter = document.getElementById('reportCounter');
                
                descInput.addEventListener('input', () => {
                    descCounter.textContent = `${descInput.value.length}/500 caracteres`;
                });
                
                // Event listeners
                document.getElementById('cancelReportBtn').addEventListener('click', () => {
                    this.hideModal('reportModal');
                });
                
                document.getElementById('submitReportBtn').addEventListener('click', () => {
                    this.submitReport(userCode, conversationId);
                });
                
                this.showModal('reportModal');
            },
            
            submitReport(userCode, conversationId) {
                const reason = document.getElementById('reportReason').value;
                const description = document.getElementById('reportDescription').value.trim();
                
                if (!reason || !description) {
                    this.showNotification('Preencha todos os campos', 'error');
                    return;
                }
                
                // Criar den√∫ncia
                const report = {
                    id: this.generateId(),
                    reporter: this.state.currentUser.code,
                    reportedUser: userCode,
                    conversationId: conversationId,
                    reason: reason,
                    description: description,
                    status: 'pending',
                    createdAt: Date.now()
                };
                
                this.state.reports.push(report);
                this.saveToStorage();
                
                this.hideModal('reportModal');
                this.showNotification('Den√∫ncia enviada com sucesso!', 'success');
            },
            
            // ============================================
            // SISTEMA DE REPUTA√á√ÉO E AVALIA√á√ïES
            // ============================================
            
            // Carregar p√°gina de avalia√ß√µes
            loadReviewsPage() {
                if (!this.state.currentUser) return;
                
                // Avalia√ß√µes recebidas
                const receivedReviews = this.state.ratings
                    .filter(r => r.toUser === this.state.currentUser.code)
                    .sort((a, b) => b.createdAt - a.createdAt);
                
                const receivedContainer = document.getElementById('receivedReviews');
                const emptyReceived = document.getElementById('emptyReceivedReviews');
                
                if (receivedReviews.length === 0) {
                    receivedContainer.innerHTML = '';
                    emptyReceived.classList.remove('d-none');
                } else {
                    emptyReceived.classList.add('d-none');
                    
                    let html = '';
                    receivedReviews.forEach(review => {
                        const fromUser = this.state.users[review.fromUser] || { name: 'Usu√°rio SYNTA' };
                        const date = new Date(review.createdAt).toLocaleDateString();
                        
                        html += `
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="review-rating">
                                        ${Array.from({length: 5}).map((_, i) => 
                                            `<i class="fas fa-star review-star ${i < review.rating ? 'selected' : ''}"></i>`
                                        ).join('')}
                                        <span style="margin-left: 0.5rem; font-weight: 600;">${review.rating.toFixed(1)}</span>
                                    </div>
                                    <div class="review-date">${date}</div>
                                </div>
                                ${review.comment ? `
                                    <div class="review-comment mt-2">
                                        "${this.escapeHtml(review.comment)}"
                                    </div>
                                ` : ''}
                                <div class="text-muted mt-2" style="font-size: 0.875rem;">
                                    <i class="fas fa-user-secret"></i> Avalia√ß√£o an√¥nima
                                </div>
                            </div>
                        `;
                    });
                    
                    receivedContainer.innerHTML = html;
                }
                
                // Avalia√ß√µes enviadas
                const sentReviews = this.state.ratings
                    .filter(r => r.fromUser === this.state.currentUser.code)
                    .sort((a, b) => b.createdAt - a.createdAt);
                
                const sentContainer = document.getElementById('sentReviews');
                const emptySent = document.getElementById('emptySentReviews');
                
                if (sentReviews.length === 0) {
                    sentContainer.innerHTML = '';
                    emptySent.classList.remove('d-none');
                } else {
                    emptySent.classList.add('d-none');
                    
                    let html = '';
                    sentReviews.forEach(review => {
                        const toUser = this.state.users[review.toUser] || { name: 'Usu√°rio SYNTA' };
                        const date = new Date(review.createdAt).toLocaleDateString();
                        
                        html += `
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="review-rating">
                                        ${Array.from({length: 5}).map((_, i) => 
                                            `<i class="fas fa-star review-star ${i < review.rating ? 'selected' : ''}"></i>`
                                        ).join('')}
                                        <span style="margin-left: 0.5rem; font-weight: 600;">${review.rating.toFixed(1)}</span>
                                    </div>
                                    <div class="review-date">${date}</div>
                                </div>
                                <div class="text-muted" style="font-size: 0.875rem;">
                                    <i class="fas fa-user"></i> Para: ${this.escapeHtml(toUser.name)}
                                </div>
                                ${review.comment ? `
                                    <div class="review-comment mt-2">
                                        "${this.escapeHtml(review.comment)}"
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                    
                    sentContainer.innerHTML = html;
                }
                
                // Atualizar rating do usu√°rio
                const userRating = this.calculateUserRating(this.state.currentUser.code);
                document.getElementById('userRatingValue').textContent = userRating.average.toFixed(1);
                document.getElementById('userReviewCount').textContent = userRating.count;
                
                // Atualizar estrelas na sidebar
                const stars = document.querySelectorAll('.user-card .fa-star');
                stars.forEach((star, index) => {
                    if (index < Math.floor(userRating.average)) {
                        star.classList.add('selected');
                    } else {
                        star.classList.remove('selected');
                    }
                });
            },
            
            // ============================================
            // FUN√á√ïES AUXILIARES E UTILIT√ÅRIOS
            // ============================================
            
            // Configurar Event Listeners
            setupEventListeners() {
                // Acesso
                document.getElementById('accessForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAccess();
                });
                
                document.getElementById('createAccountLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.createAccount();
                });
                
                // Navega√ß√£o
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = item.dataset.page;
                        this.showPage(page);
                    });
                });
                
                document.getElementById('homeLogo').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showPage('feed');
                });
                
                // Bot√µes principais
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('newPostBtn').addEventListener('click', () => this.showCreatePostModal());
                document.getElementById('createFirstPost').addEventListener('click', () => this.showCreatePostModal());
                document.getElementById('editProfileBtn').addEventListener('click', () => this.showPage('profile'));
                document.getElementById('backToMessages').addEventListener('click', () => this.showPage('messages'));
                document.getElementById('myPostsBtn').addEventListener('click', () => this.showPage('myPosts'));
                document.getElementById('newPostFromProfileBtn').addEventListener('click', () => this.showCreatePostModal());
                
                // Filtros do feed
                document.querySelectorAll('[data-filter]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-filter]').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');
                        const filter = btn.dataset.filter;
                        this.filterPosts(filter);
                    });
                });
                
                // Chat
                document.getElementById('sendMessageBtn').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                // Mapa
                document.getElementById('locateMeBtn').addEventListener('click', () => this.locateOnMap());
                document.getElementById('refreshMapBtn').addEventListener('click', () => this.refreshMap());
                
                // Perfil
                document.getElementById('profileForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProfile();
                });
                
                document.getElementById('resetProfileBtn').addEventListener('click', () => {
                    if (confirm('Redefinir perfil para configura√ß√µes padr√£o?')) {
                        this.resetProfile();
                    }
                });
                
                // Admin
                document.getElementById('resetSystemBtn').addEventListener('click', () => {
                    if (confirm('Isso ir√° resetar todo o sistema. Continuar?')) {
                        this.resetSystem();
                    }
                });
                
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    this.saveSystemSettings();
                });
                
                // Modal de post
                document.getElementById('postForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createPost();
                });
                
                document.getElementById('cancelPostBtn').addEventListener('click', () => {
                    this.hideModal('createPostModal');
                });
                
                document.getElementById('closePostModal').addEventListener('click', () => {
                    this.hideModal('createPostModal');
                });
                
                // Modal de visualiza√ß√£o
                document.getElementById('closeViewModal').addEventListener('click', () => {
                    this.hideModal('viewPostModal');
                });
                
                // Modal de edi√ß√£o
                document.getElementById('closeEditModal').addEventListener('click', () => {
                    this.hideModal('editPostModal');
                });
                
                // Modal de c√≥digos
                document.getElementById('closeCodesModal').addEventListener('click', () => {
                    this.hideModal('postCodesModal');
                });
                
                // Modal de avalia√ß√£o
                document.getElementById('closeRatingModal').addEventListener('click', () => {
                    this.hideModal('ratingModal');
                });
                
                // Modal de den√∫ncia
                document.getElementById('closeReportModal').addEventListener('click', () => {
                    this.hideModal('reportModal');
                });
                
                // Gerenciamento de posts
                document.getElementById('loadPostByCodeBtn').addEventListener('click', () => {
                    this.loadPostByEditCode();
                });
                
                // Contadores de caracteres
                const titleInput = document.getElementById('postTitle');
                const descInput = document.getElementById('postDescription');
                const titleCounter = document.getElementById('titleCounter');
                const descCounter = document.getElementById('descCounter');
                
                if (titleInput && titleCounter) {
                    titleInput.addEventListener('input', () => {
                        titleCounter.textContent = `${titleInput.value.length}/100 caracteres`;
                    });
                }
                
                if (descInput && descCounter) {
                    descInput.addEventListener('input', () => {
                        descCounter.textContent = `${descInput.value.length}/500 caracteres`;
                    });
                }
                
                // PWA Install
                document.getElementById('installBtn').addEventListener('click', () => this.installPWA());
                document.getElementById('dismissInstall').addEventListener('click', () => this.hideInstallPrompt());
                
                // Evento PWA beforeinstallprompt
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.state.deferredPrompt = e;
                    this.showInstallPrompt();
                });
                
                // Atualizar GPS periodicamente
                setInterval(() => {
                    this.updateGPSLocation();
                }, 30000); // A cada 30 segundos
            },
            
            // Atualizar localiza√ß√£o GPS
            updateGPSLocation() {
                if (!('geolocation' in navigator) || !this.state.currentUser) return;
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.state.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: Date.now()
                        };
                        
                        this.state.gpsStatus = 'active';
                        document.getElementById('gpsAccuracy').textContent = Math.round(this.state.userLocation.accuracy);
                        
                        // Atualizar feed se estiver ativo
                        if (this.state.currentPage === 'feed') {
                            this.loadPosts();
                        }
                    },
                    () => {
                        this.state.gpsStatus = 'inactive';
                        this.showNotification('GPS perdido. Verifique sua conex√£o.', 'warning');
                    },
                    { enableHighAccuracy: true, maximumAge: 30000, timeout: 10000 }
                );
            },
            
            // Sistema de Armazenamento
            loadFromStorage() {
                try {
                    const saved = localStorage.getItem(this.config.storageKey);
                    if (saved) {
                        const data = JSON.parse(saved);
                        
                        // Carregar dados b√°sicos
                        this.state.currentUser = data.currentUser || null;
                        this.state.posts = data.posts || [];
                        this.state.conversations = data.conversations || [];
                        this.state.users = data.users || {};
                        this.state.ratings = data.ratings || [];
                        this.state.reports = data.reports || [];
                        
                        // Verificar se √© admin
                        if (this.state.currentUser && this.state.currentUser.code === this.config.adminCode) {
                            this.state.isAdmin = true;
                            document.getElementById('adminNav').classList.remove('d-none');
                        }
                        
                        console.log('Dados carregados do armazenamento local');
                        
                        // Se n√£o houver dados, inicializar demo
                        if (this.state.posts.length === 0) {
                            this.initializeDemoData();
                        }
                    } else {
                        this.initializeDemoData();
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    this.initializeDemoData();
                }
            },
            
            saveToStorage() {
                try {
                    const data = {
                        currentUser: this.state.currentUser,
                        posts: this.state.posts,
                        conversations: this.state.conversations,
                        users: this.state.users,
                        ratings: this.state.ratings,
                        reports: this.state.reports,
                        timestamp: Date.now(),
                        version: this.config.version
                    };
                    
                    localStorage.setItem(this.config.storageKey, JSON.stringify(data));
                    console.log('Dados salvos no armazenamento local');
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    this.showNotification('Erro ao salvar dados', 'error');
                }
            },
            
            // Inicializar dados de demonstra√ß√£o
            initializeDemoData() {
                console.log('Inicializando dados de demonstra√ß√£o...');
                
                // Usu√°rios demo
                this.state.users = {
                    'SYNTA-ADMIN': {
                        name: 'Administrador',
                        avatar: null,
                        location: 'S√£o Paulo, Brasil',
                        reputation: 95,
                        joined: Date.now() - 30 * 24 * 3600000,
                        stats: { posts: 5, messages: 20, connections: 15, reputation: 95, reviewsGiven: 8 },
                        email: 'admin@syntax.com',
                        settings: {
                            notifyMessages: true,
                            notifyProposals: true,
                            notifyNearby: true,
                            defaultAnonymity: 'partial'
                        }
                    },
                    'SYNTA-USER': {
                        name: 'Usu√°rio Demo',
                        avatar: null,
                        location: 'Rio de Janeiro, Brasil',
                        reputation: 88,
                        joined: Date.now() - 15 * 24 * 3600000,
                        stats: { posts: 3, messages: 8, connections: 5, reputation: 88, reviewsGiven: 3 },
                        email: 'user@demo.com',
                        settings: {
                            notifyMessages: true,
                            notifyProposals: true,
                            notifyNearby: true,
                            defaultAnonymity: 'full'
                        }
                    }
                };
                
                // Avalia√ß√µes demo
                this.state.ratings = [
                    {
                        id: this.generateId(),
                        fromUser: 'SYNTA-ADMIN',
                        toUser: 'SYNTA-USER',
                        conversationId: 'demo-conv-1',
                        rating: 5,
                        comment: '√ìtima comunica√ß√£o, recomendo!',
                        createdAt: Date.now() - 86400000,
                        anonymous: true
                    },
                    {
                        id: this.generateId(),
                        fromUser: 'SYNTA-USER',
                        toUser: 'SYNTA-ADMIN',
                        conversationId: 'demo-conv-1',
                        rating: 4,
                        comment: 'Boa experi√™ncia, muito profissional.',
                        createdAt: Date.now() - 172800000,
                        anonymous: true
                    }
                ];
                
                // Posts demo
                this.state.posts = [
                    {
                        id: this.generateId(),
                        postCode: 'POSTA-1234',
                        entryCode: 'USER-ABCD',
                        title: 'Procuro parceiro para startup de tecnologia',
                        description: 'Desenvolvendo uma plataforma inovadora e busco co-founder com experi√™ncia em marketing digital e vendas. Interessados enviar proposta.',
                        category: 'business',
                        location: { lat: -23.5505, lng: -46.6333, city: 'S√£o Paulo, Brasil', accuracy: 50 },
                        author: 'SYNTA-ADMIN',
                        authorName: 'Administrador',
                        email: 'admin@syntax.com',
                        createdAt: Date.now() - 3600000,
                        expiresAt: Date.now() + 14 * 24 * 3600000,
                        proposals: 3,
                        anonymity: 'partial',
                        distance: 0.5,
                        status: 'active',
                        isPublic: true,
                        views: 12
                    },
                    {
                        id: this.generateId(),
                        postCode: 'POSTB-5678',
                        entryCode: 'USER-EFGH',
                        title: 'Grupo de estudos de programa√ß√£o',
                        description: 'Encontros semanais para estudar JavaScript, React e Node.js. Todos os n√≠veis s√£o bem-vindos! Local: Parque Ibirapuera.',
                        category: 'learning',
                        location: { lat: -23.5503, lng: -46.6342, city: 'S√£o Paulo, Brasil', accuracy: 100 },
                        author: 'SYNTA-USER',
                        authorName: 'Usu√°rio Demo',
                        email: 'user@demo.com',
                        createdAt: Date.now() - 7200000,
                        expiresAt: Date.now() + 7 * 24 * 3600000,
                        proposals: 5,
                        anonymity: 'full',
                        distance: 1.2,
                        status: 'active',
                        isPublic: true,
                        views: 8
                    }
                ];
                
                // Conversas demo
                this.state.conversations = [
                    {
                        id: 'demo-conv-1',
                        participants: ['SYNTA-USER', 'SYNTA-ADMIN'],
                        postId: this.state.posts[0].id,
                        postTitle: 'Procuro parceiro para startup de tecnologia',
                        lastMessage: 'Podemos marcar uma reuni√£o para discutir os detalhes?',
                        lastMessageTime: Date.now() - 1800000,
                        unread: false,
                        messages: [
                            {
                                id: this.generateId(),
                                sender: 'SYNTA-USER',
                                content: 'Ol√°! Tenho interesse na sua proposta de startup.',
                                timestamp: Date.now() - 1800000,
                                read: true
                            },
                            {
                                id: this.generateId(),
                                sender: 'SYNTA-ADMIN',
                                content: 'Que bom! Conte-me mais sobre sua experi√™ncia.',
                                timestamp: Date.now() - 1200000,
                                read: true
                            },
                            {
                                id: this.generateId(),
                                sender: 'SYNTA-USER',
                                content: 'Tenho 5 anos em marketing digital e j√° ajudei 3 startups a crescer.',
                                timestamp: Date.now() - 600000,
                                read: true
                            },
                            {
                                id: this.generateId(),
                                sender: 'SYNTA-ADMIN',
                                content: 'Perfeito! Podemos marcar uma reuni√£o para discutir os detalhes?',
                                timestamp: Date.now() - 300000,
                                read: true
                            }
                        ]
                    }
                ];
                
                this.saveToStorage();
            },
            
            // ... (Restante das fun√ß√µes do sistema anterior mantidas, mas adaptadas)
            
            // Login com c√≥digo
            login(code) {
                // Validar formato
                if (!this.validateCode(code, 'user')) {
                    this.showNotification('Formato inv√°lido. Use: SYNTA-XXXXXX', 'error');
                    return;
                }
                
                // Verificar se usu√°rio existe
                if (this.state.users[code]) {
                    this.state.currentUser = {
                        code: code,
                        name: this.state.users[code].name,
                        avatar: this.state.users[code].avatar,
                        location: this.state.users[code].location,
                        settings: this.state.users[code].settings || {
                            notifyMessages: true,
                            notifyProposals: true,
                            notifyNearby: true,
                            defaultAnonymity: 'full'
                        },
                        stats: this.state.users[code].stats,
                        email: this.state.users[code].email
                    };
                    
                    // Verificar se √© admin
                    if (code === this.config.adminCode) {
                        this.state.isAdmin = true;
                        document.getElementById('adminNav').classList.remove('d-none');
                    }
                    
                    this.saveToStorage();
                    this.showDashboard();
                    this.showNotification(`Bem-vindo, ${this.state.currentUser.name}!`, 'success');
                } else {
                    // Criar novo usu√°rio
                    this.createUser(code);
                }
            },
            
            // Criar novo usu√°rio
            createUser(code) {
                const newUser = {
                    name: `Usu√°rio ${code.substring(6)}`,
                    avatar: null,
                    location: 'Local n√£o definido',
                    reputation: 100,
                    joined: Date.now(),
                    stats: { posts: 0, messages: 0, connections: 0, reputation: 100, reviewsGiven: 0 },
                    settings: {
                        notifyMessages: true,
                        notifyProposals: true,
                        notifyNearby: true,
                        defaultAnonymity: 'full'
                    },
                    email: null,
                    lastActive: Date.now()
                };
                
                this.state.users[code] = newUser;
                
                this.state.currentUser = {
                    code: code,
                    name: newUser.name,
                    avatar: newUser.avatar,
                    location: newUser.location,
                    settings: newUser.settings,
                    stats: newUser.stats,
                    email: newUser.email
                };
                
                this.saveToStorage();
                this.showDashboard();
                this.showNotification(`Conta criada! Seu c√≥digo: ${code}`, 'success');
            },
            
            // Acesso r√°pido
            quickStart() {
                const code = this.generateCode('user');
                this.login(code);
            },
            
            // Criar conta
            createAccount() {
                const code = this.generateCode('user');
                this.login(code);
            },
            
            // Handler de acesso
            handleAccess() {
                const codeInput = document.getElementById('accessCode');
                const code = codeInput.value.trim().toUpperCase();
                
                if (!code) {
                    this.showNotification('Digite um c√≥digo', 'error');
                    return;
                }
                
                this.login(code);
            },
            
            // Mostrar dashboard
            showDashboard() {
                document.getElementById('accessScreen').classList.add('d-none');
                document.getElementById('dashboardContent').classList.remove('d-none');
                document.getElementById('userCodeHeader').textContent = this.state.currentUser.code;
                
                this.updateUI();
                this.showPage('feed');
                this.loadPosts();
                this.setupMap();
            },
            
            // Logout
            logout() {
                if (confirm('Deseja sair da sua conta?')) {
                    this.state.currentUser = null;
                    this.state.isAdmin = false;
                    
                    document.getElementById('dashboardContent').classList.add('d-none');
                    document.getElementById('accessScreen').classList.remove('d-none');
                    document.getElementById('adminNav').classList.add('d-none');
                    
                    this.showNotification('Voc√™ saiu da sua conta', 'info');
                }
            },
            
            // Navega√ß√£o entre p√°ginas
            showPage(page) {
                // Atualizar estado
                this.state.currentPage = page;
                
                // Atualizar navega√ß√£o
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.page === page) {
                        item.classList.add('active');
                    }
                });
                
                // Mostrar p√°gina
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.getElementById(page + 'Page').classList.add('active');
                
                // Carregar dados da p√°gina
                switch(page) {
                    case 'feed':
                        this.loadPosts();
                        break;
                    case 'messages':
                        this.loadConversations();
                        break;
                    case 'chat':
                        this.loadChat();
                        break;
                    case 'map':
                        this.updateMap();
                        break;
                    case 'profile':
                        this.loadProfile();
                        break;
                    case 'reviews':
                        this.loadReviewsPage();
                        break;
                    case 'myPosts':
                        this.loadMyPosts();
                        break;
                    case 'admin':
                        this.loadAdminPanel();
                        break;
                }
                
                // Scroll para topo
                window.scrollTo(0, 0);
            },
            
            // Atualizar UI
            updateUI() {
                if (!this.state.currentUser) return;
                
                const user = this.state.currentUser;
                const userRating = this.calculateUserRating(user.code);
                
                // Atualizar sidebar
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userLocation').textContent = user.location;
                document.getElementById('userCodeSidebar').textContent = user.code;
                document.getElementById('userRatingValue').textContent = userRating.average.toFixed(1);
                document.getElementById('userReviewCount').textContent = userRating.count;
                
                // Atualizar avatar
                const avatarText = document.getElementById('avatarText');
                const avatarContainer = document.getElementById('userAvatar');
                
                if (user.avatar) {
                    avatarText.style.display = 'none';
                    avatarContainer.innerHTML = `<img src="${this.escapeHtml(user.avatar)}" alt="${this.escapeHtml(user.name)}">`;
                } else {
                    avatarText.style.display = 'flex';
                    avatarText.textContent = user.name.charAt(0);
                }
                
                // Atualizar estat√≠sticas
                document.getElementById('activePosts').textContent = user.stats.posts || 0;
                document.getElementById('unreadMessages').textContent = this.getUnreadCount();
                document.getElementById('connections').textContent = user.stats.connections || 0;
                document.getElementById('reputation').textContent = user.stats.reputation || 100;
                
                // Atualizar estrelas do rating
                const stars = document.querySelectorAll('.user-card .fa-star');
                stars.forEach((star, index) => {
                    if (index < Math.floor(userRating.average)) {
                        star.classList.add('selected');
                    } else {
                        star.classList.remove('selected');
                    }
                });
            },
            
            // Carregar conversas
            loadConversations() {
                const container = document.getElementById('conversationsList');
                const emptyState = document.getElementById('emptyMessages');
                
                if (this.state.conversations.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('d-none');
                    return;
                }
                
                emptyState.classList.add('d-none');
                
                // Ordenar por √∫ltima mensagem
                const sortedConversations = [...this.state.conversations].sort((a, b) => 
                    b.lastMessageTime - a.lastMessageTime
                );
                
                let html = '';
                
                sortedConversations.forEach(conv => {
                    const otherParticipant = conv.participants.find(p => p !== this.state.currentUser.code);
                    const otherUser = this.state.users[otherParticipant] || { name: 'Usu√°rio SYNTA' };
                    const timeAgo = this.formatTime(conv.lastMessageTime);
                    const otherRating = this.calculateUserRating(otherParticipant);
                    const hasRated = this.hasRatedConversation(conv.id, this.state.currentUser.code);
                    
                    html += `
                        <div class="conversation-item ${conv.unread ? 'unread' : ''}" data-conversation-id="${conv.id}">
                            <div class="user-avatar" style="width: 48px; height: 48px;">
                                ${otherUser.avatar ? 
                                    `<img src="${this.escapeHtml(otherUser.avatar)}" alt="${this.escapeHtml(otherUser.name)}">` :
                                    otherUser.name.charAt(0)
                                }
                            </div>
                            <div style="flex: 1;">
                                <div class="d-flex justify-between">
                                    <div>
                                        <h4 class="text-primary">${this.escapeHtml(otherUser.name)}</h4>
                                        <div class="rating-stars" style="font-size: 0.75rem;">
                                            <i class="fas fa-star ${otherRating.average >= 1 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${otherRating.average >= 2 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${otherRating.average >= 3 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${otherRating.average >= 4 ? 'selected' : ''}"></i>
                                            <i class="fas fa-star ${otherRating.average >= 5 ? 'selected' : ''}"></i>
                                            <span style="font-size: 0.75rem; color: var(--gray-500); margin-left: 0.25rem;">
                                                ${otherRating.average.toFixed(1)}
                                            </span>
                                            ${hasRated ? '<span class="badge" style="background: var(--accent); margin-left: 0.5rem;">Avaliado</span>' : ''}
                                        </div>
                                    </div>
                                    <span class="text-muted" style="font-size: 0.875rem;">${timeAgo}</span>
                                </div>
                                <p class="text-muted" style="font-size: 0.875rem;">
                                    <strong>${this.escapeHtml(conv.postTitle)}</strong> ‚Ä¢ ${this.escapeHtml(conv.lastMessage.substring(0, 50))}...
                                </p>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Adicionar event listeners
                document.querySelectorAll('.conversation-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const conversationId = item.dataset.conversationId;
                        const conversation = this.state.conversations.find(c => c.id === conversationId);
                        if (conversation) {
                            this.state.selectedConversation = conversation;
                            this.showPage('chat');
                        }
                    });
                });
                
                // Atualizar badge
                this.updateMessageBadge();
            },
            
            // Enviar mensagem
            sendMessage() {
                const input = document.getElementById('messageInput');
                const content = input.value.trim();
                
                if (!content || !this.state.selectedConversation) return;
                
                // Criar mensagem
                const message = {
                    id: this.generateId(),
                    sender: this.state.currentUser.code,
                    content: content,
                    timestamp: Date.now(),
                    read: false
                };
                
                // Adicionar √† conversa
                this.state.selectedConversation.messages.push(message);
                this.state.selectedConversation.lastMessage = content;
                this.state.selectedConversation.lastMessageTime = Date.now();
                
                // Atualizar estat√≠sticas
                this.state.currentUser.stats.messages = (this.state.currentUser.stats.messages || 0) + 1;
                
                this.saveToStorage();
                
                // Limpar input e atualizar chat
                input.value = '';
                this.loadChat();
                
                // Simular resposta (apenas para demo)
                if (!this.state.selectedConversation.participants.includes('SYNTA-ADMIN') && 
                    !this.state.selectedConversation.participants.includes('SYNTA-USER')) {
                    setTimeout(() => {
                        this.simulateReply();
                    }, 1000 + Math.random() * 2000);
                }
            },
            
            // Contar mensagens n√£o lidas
            getUnreadCount() {
                return this.state.conversations.filter(conv => conv.unread).length;
            },
            
            // Atualizar badge de mensagens
            updateMessageBadge() {
                const unreadCount = this.getUnreadCount();
                const badge = document.getElementById('messageBadge');
                
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                    badge.classList.remove('d-none');
                } else {
                    badge.classList.add('d-none');
                }
            },
            
            // Configurar mapa
            setupMap() {
                if (this.state.map) return;
                
                // Inicializar mapa
                this.state.map = L.map('globalMap').setView([0, 0], 2);
                
                // Adicionar tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(this.state.map);
                
                // Adicionar marcadores
                this.updateMap();
            },
            
            // Atualizar mapa
            updateMap() {
                if (!this.state.map) return;
                
                // Limpar marcadores existentes
                this.state.map.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        this.state.map.removeLayer(layer);
                    }
                });
                
                // Adicionar marcadores para posts ativos dentro de 50km
                this.state.posts
                    .filter(post => post.status === 'active' && post.location && post.location.lat)
                    .forEach(post => {
                        // Verificar dist√¢ncia
                        if (this.state.userLocation) {
                            const distance = this.calculateDistance(
                                this.state.userLocation.lat,
                                this.state.userLocation.lng,
                                post.location.lat,
                                post.location.lng
                            );
                            
                            if (distance > this.config.maxDistance) {
                                return; // N√£o mostrar posts fora de 50km
                            }
                        }
                        
                        const category = this.config.categories.find(c => c.id === post.category);
                        
                        const marker = L.marker([post.location.lat, post.location.lng], {
                            icon: L.divIcon({
                                className: 'custom-marker',
                                html: `
                                    <div style="
                                        width: 32px;
                                        height: 32px;
                                        background: ${category.color};
                                        border: 3px solid white;
                                        border-radius: 50%;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: white;
                                        font-size: 14px;
                                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                                        cursor: pointer;
                                    ">
                                        <i class="fas ${category.icon}"></i>
                                    </div>
                                `,
                                iconSize: [32, 32],
                                iconAnchor: [16, 16]
                            })
                        }).addTo(this.state.map);
                        
                        marker.bindTooltip(`
                            <div style="font-weight: 600;">${this.escapeHtml(post.title)}</div>
                            <div style="font-size: 12px; color: #666;">
                                <i class="fas ${category.icon}"></i> ${category.name}
                            </div>
                        `);
                        
                        marker.on('click', () => {
                            this.viewPost(post.id);
                        });
                    });
                
                // Centralizar no usu√°rio se dispon√≠vel
                if (this.state.userLocation) {
                    this.state.map.setView([this.state.userLocation.lat, this.state.userLocation.lng], 12);
                    
                    // Adicionar marcador do usu√°rio
                    L.marker([this.state.userLocation.lat, this.state.userLocation.lng], {
                        icon: L.divIcon({
                            className: 'user-marker',
                            html: `
                                <div style="
                                    width: 40px;
                                    height: 40px;
                                    background: var(--primary);
                                    border: 3px solid white;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-size: 16px;
                                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                                    animation: pulse 2s infinite;
                                ">
                                    <i class="fas fa-user"></i>
                                </div>
                            `,
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        })
                    }).addTo(this.state.map).bindTooltip('Voc√™ est√° aqui');
                    
                    // Adicionar c√≠rculo de 50km
                    L.circle([this.state.userLocation.lat, this.state.userLocation.lng], {
                        color: 'var(--primary)',
                        fillColor: 'var(--primary-50)',
                        fillOpacity: 0.1,
                        radius: this.config.maxDistance * 1000 // Converter km para metros
                    }).addTo(this.state.map).bindTooltip('Raio de 50km');
                }
                
                // Atualizar estat√≠sticas do mapa
                this.updateMapStats();
            },
            
            // Atualizar estat√≠sticas do mapa
            updateMapStats() {
                const activePosts = this.state.posts.filter(post => 
                    post.status === 'active' && 
                    (!this.state.userLocation || this.calculateDistance(
                        this.state.userLocation.lat,
                        this.state.userLocation.lng,
                        post.location?.lat || 0,
                        post.location?.lng || 0
                    ) <= this.config.maxDistance)
                ).length;
                
                const uniqueUsers = new Set(
                    this.state.posts
                        .filter(post => post.status === 'active')
                        .map(post => post.author)
                ).size;
                
                // Calcular rating m√©dio
                const allRatings = this.state.ratings;
                const averageRating = allRatings.length > 0 
                    ? (allRatings.reduce((sum, r) => sum + r.rating, 0) / allRatings.length).toFixed(1)
                    : '5.0';
                
                document.getElementById('totalPosts').textContent = activePosts;
                document.getElementById('activeUsers').textContent = uniqueUsers;
                document.getElementById('connectionsToday').textContent = this.state.conversations.length;
                document.getElementById('averageRating').textContent = averageRating;
            },
            
            // Carregar perfil
            loadProfile() {
                if (!this.state.currentUser) return;
                
                const user = this.state.currentUser;
                const userRating = this.calculateUserRating(user.code);
                
                // Preencher formul√°rio
                document.getElementById('displayName').value = user.name;
                document.getElementById('avatarUrl').value = user.avatar || '';
                document.getElementById('userEmail').value = user.email || '';
                
                // Configura√ß√µes
                document.getElementById('notifyMessages').checked = user.settings.notifyMessages;
                document.getElementById('notifyProposals').checked = user.settings.notifyProposals;
                document.getElementById('notifyReviews').checked = user.settings.notifyReviews !== false;
                
                // Atualizar estat√≠sticas
                document.getElementById('profilePosts').textContent = user.stats.posts || 0;
                document.getElementById('profileMessages').textContent = user.stats.messages || 0;
                document.getElementById('profileConnections').textContent = user.stats.connections || 0;
                document.getElementById('profileRating').textContent = userRating.average.toFixed(1);
            },
            
            // Salvar perfil
            saveProfile() {
                const name = document.getElementById('displayName').value.trim();
                const avatarUrl = document.getElementById('avatarUrl').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                
                if (name) {
                    this.state.currentUser.name = name;
                    this.state.users[this.state.currentUser.code].name = name;
                }
                
                if (avatarUrl) {
                    try {
                        new URL(avatarUrl);
                        this.state.currentUser.avatar = avatarUrl;
                        this.state.users[this.state.currentUser.code].avatar = avatarUrl;
                    } catch (error) {
                        this.showNotification('URL da imagem inv√°lida', 'error');
                        return;
                    }
                }
                
                if (email) {
                    if (!this.validateEmail(email)) {
                        this.showNotification('Email inv√°lido', 'error');
                        return;
                    }
                    this.state.currentUser.email = email;
                    this.state.users[this.state.currentUser.code].email = email;
                }
                
                // Configura√ß√µes
                this.state.currentUser.settings.notifyMessages = document.getElementById('notifyMessages').checked;
                this.state.currentUser.settings.notifyProposals = document.getElementById('notifyProposals').checked;
                this.state.currentUser.settings.notifyReviews = document.getElementById('notifyReviews').checked;
                
                this.saveToStorage();
                this.updateUI();
                this.showNotification('Perfil atualizado com sucesso!', 'success');
            },
            
            // Carregar painel de admin
            loadAdminPanel() {
                if (!this.state.isAdmin) return;
                
                // Atualizar estat√≠sticas
                document.getElementById('adminTotalPosts').textContent = this.state.posts.length;
                document.getElementById('adminTotalUsers').textContent = Object.keys(this.state.users).length;
                document.getElementById('adminActiveConversations').textContent = this.state.conversations.length;
                document.getElementById('adminTotalReviews').textContent = this.state.ratings.length;
                
                // Carregar tabela de usu√°rios
                this.loadAdminUsersTable();
                
                // Carregar den√∫ncias
                this.loadAdminReportsTable();
            },
            
            // Carregar tabela de usu√°rios
            loadAdminUsersTable() {
                const container = document.getElementById('adminUsersTable');
                let html = '';
                
                Object.entries(this.state.users).forEach(([code, user]) => {
                    const userRating = this.calculateUserRating(code);
                    
                    html += `
                        <tr>
                            <td><strong>${code}</strong></td>
                            <td>${this.escapeHtml(user.name)}</td>
                            <td>${this.escapeHtml(user.location)}</td>
                            <td>${user.reputation}</td>
                            <td>${userRating.count}</td>
                            <td>
                                <button class="btn btn-danger btn-small" onclick="SYNTA.deleteUser('${code}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                container.innerHTML = html;
            },
            
            // Carregar tabela de den√∫ncias
            loadAdminReportsTable() {
                const container = document.getElementById('adminReportsTable');
                let html = '';
                
                this.state.reports
                    .sort((a, b) => b.createdAt - a.createdAt)
                    .slice(0, 10)
                    .forEach(report => {
                        const reportedUser = this.state.users[report.reportedUser] || { name: 'Usu√°rio Desconhecido' };
                        const date = new Date(report.createdAt).toLocaleDateString();
                        
                        html += `
                            <tr>
                                <td>${report.id.substring(0, 8)}</td>
                                <td>${this.escapeHtml(reportedUser.name)}</td>
                                <td>${this.escapeHtml(report.reason)}</td>
                                <td>${date}</td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="SYNTA.viewReport('${report.id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                
                container.innerHTML = html;
            },
            
            // ============================================
            // FUN√á√ïES ADICIONAIS DO SISTEMA
            // ============================================
            
            // Mostrar modal de cria√ß√£o de post
            showCreatePostModal() {
                if (!this.state.currentUser) return;
                
                // Verificar GPS
                if (!this.state.userLocation) {
                    this.showNotification('GPS necess√°rio para criar post', 'error');
                    return;
                }
                
                // Resetar formul√°rio
                document.getElementById('postForm').reset();
                document.getElementById('titleCounter').textContent = '0/100 caracteres';
                document.getElementById('descCounter').textContent = '0/500 caracteres';
                
                // Preencher localiza√ß√£o
                this.getCityName(this.state.userLocation.lat, this.state.userLocation.lng)
                    .then(city => {
                        document.getElementById('postLocation').value = city;
                    });
                
                document.getElementById('locationAccuracy').innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>Localiza√ß√£o precisa (${Math.round(this.state.userLocation.accuracy)}m)</span>
                `;
                
                this.showModal('createPostModal');
            },
            
            // Visualizar post
            viewPost(postId) {
                const post = this.state.posts.find(p => p.id === postId);
                if (!post) return;
                
                this.state.selectedPost = post;
                
                const category = this.config.categories.find(c => c.id === post.category);
                const authorInfo = post.anonymity === 'full' ? 
                    `C√≥digo: ${post.author}` : 
                    `${post.authorName} (${post.author})`;
                
                const authorRating = this.calculateUserRating(post.author);
                
                const content = `
                    <div class="mb-3">
                        <span class="post-category" style="background: ${category.color}20; color: ${category.color};">
                            <i class="fas ${category.icon}"></i> ${category.name}
                        </span>
                        <div class="text-muted mt-1">
                            <i class="far fa-clock"></i> ${this.formatTime(post.createdAt)}
                            ${post.distance ? ` ‚Ä¢ <i class="fas fa-map-marker-alt"></i> ${post.distance.toFixed(1)}km` : ''}
                            ‚Ä¢ <i class="fas fa-hashtag"></i> ${post.postCode}
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="text-primary mb-1">Descri√ß√£o</h4>
                        <p style="color: var(--gray-700); line-height: 1.6;">${this.escapeHtml(post.description)}</p>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="text-primary mb-1">Publicado por</h4>
                        <div class="d-flex align-center gap-2">
                            <div>
                                <p style="color: var(--gray-700);">
                                    <i class="fas fa-user-secret"></i> ${authorInfo}
                                </p>
                                <div class="rating-stars" style="font-size: 0.875rem;">
                                    <i class="fas fa-star ${authorRating.average >= 1 ? 'selected' : ''}"></i>
                                    <i class="fas fa-star ${authorRating.average >= 2 ? 'selected' : ''}"></i>
                                    <i class="fas fa-star ${authorRating.average >= 3 ? 'selected' : ''}"></i>
                                    <i class="fas fa-star ${authorRating.average >= 4 ? 'selected' : ''}"></i>
                                    <i class="fas fa-star ${authorRating.average >= 5 ? 'selected' : ''}"></i>
                                    <span style="font-size: 0.875rem; color: var(--gray-500); margin-left: 0.25rem;">
                                        ${authorRating.average.toFixed(1)} (${authorRating.count} avalia√ß√µes)
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="text-primary mb-1">Localiza√ß√£o</h4>
                        <p style="color: var(--gray-700);">
                            <i class="fas fa-map-marker-alt"></i> ${post.location.city}
                        </p>
                    </div>
                    
                    ${post.email ? `
                        <div class="alert alert-info mb-4">
                            <div class="d-flex align-center gap-1">
                                <i class="fas fa-envelope"></i>
                                <div>
                                    <strong>Contato por email dispon√≠vel</strong>
                                    <p class="mb-0">O autor receber√° seu email quando voc√™ enviar uma proposta</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="d-flex gap-2">
                        <button class="btn btn-secondary" id="closeViewBtn">
                            Fechar
                        </button>
                        <button class="btn btn-primary" id="sendProposalBtn">
                            <i class="fas fa-paper-plane"></i> Enviar Proposta
                        </button>
                    </div>
                `;
                
                document.getElementById('viewPostTitle').textContent = post.title;
                document.getElementById('viewPostContent').innerHTML = content;
                
                // Adicionar event listeners
                document.getElementById('closeViewBtn').addEventListener('click', () => {
                    this.hideModal('viewPostModal');
                });
                
                document.getElementById('sendProposalBtn').addEventListener('click', () => {
                    this.sendProposal(post);
                });
                
                this.showModal('viewPostModal');
            },
            
            // Enviar proposta
            sendProposal(post) {
                if (!this.state.currentUser) return;
                
                if (post.author === this.state.currentUser.code) {
                    this.showNotification('Voc√™ n√£o pode enviar proposta para seu pr√≥prio post', 'warning');
                    return;
                }
                
                // Verificar se j√° existe conversa
                const existingConversation = this.state.conversations.find(conv => 
                    conv.postId === post.id && 
                    conv.participants.includes(this.state.currentUser.code)
                );
                
                if (existingConversation) {
                    this.showNotification('Voc√™ j√° enviou uma proposta para este post', 'info');
                    this.state.selectedConversation = existingConversation;
                    this.showPage('chat');
                    return;
                }
                
                // Criar nova conversa
                const conversation = {
                    id: this.generateId(),
                    participants: [this.state.currentUser.code, post.author],
                    postId: post.id,
                    postTitle: post.title,
                    lastMessage: 'Proposta enviada',
                    lastMessageTime: Date.now(),
                    unread: false,
                    messages: [
                        {
                            id: this.generateId(),
                            sender: this.state.currentUser.code,
                            content: 'Ol√°! Tenho interesse na sua proposta.',
                            timestamp: Date.now(),
                            read: false
                        }
                    ]
                };
                
                this.state.conversations.unshift(conversation);
                
                // Atualizar contador de propostas
                post.proposals = (post.proposals || 0) + 1;
                
                // Atualizar estat√≠sticas
                this.state.currentUser.stats.messages = (this.state.currentUser.stats.messages || 0) + 1;
                this.state.currentUser.stats.connections = (this.state.currentUser.stats.connections || 0) + 1;
                this.state.users[this.state.currentUser.code].stats = this.state.currentUser.stats;
                
                this.saveToStorage();
                this.hideModal('viewPostModal');
                this.state.selectedConversation = conversation;
                this.showPage('chat');
                this.showNotification('Proposta enviada com sucesso!', 'success');
            },
            
            // ============================================
            // FUN√á√ïES UTILIT√ÅRIAS
            // ============================================
            
            // Calcular dist√¢ncia entre dois pontos
            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371; // Raio da Terra em km
                const dLat = this.deg2rad(lat2 - lat1);
                const dLon = this.deg2rad(lon2 - lon1);
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            },
            
            deg2rad(deg) {
                return deg * (Math.PI/180);
            },
            
            // Obter nome da cidade
            async getCityName(lat, lng) {
                try {
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.address.city || data.address.town || data.address.village || 
                               data.address.municipality || data.address.county || 'Local desconhecido';
                    }
                } catch (error) {
                    console.warn('Erro ao obter cidade:', error);
                }
                
                return 'Sua localiza√ß√£o';
            },
            
            // Validar email
            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },
            
            // Verificar palavras proibidas
            containsBannedWords(text) {
                const lowerText = text.toLowerCase();
                return this.config.bannedWords.some(word => lowerText.includes(word.toLowerCase()));
            },
            
            // Mostrar modal
            showModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            },
            
            // Esconder modal
            hideModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = '';
            },
            
            // Mostrar notifica√ß√£o
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const title = document.getElementById('notificationTitle');
                const msg = document.getElementById('notificationMessage');
                const icon = notification.querySelector('.notification-icon i');
                
                notification.className = `notification active`;
                
                switch(type) {
                    case 'success':
                        icon.className = 'fas fa-check-circle';
                        title.textContent = 'Sucesso';
                        notification.style.borderLeftColor = 'var(--accent)';
                        break;
                    case 'warning':
                        icon.className = 'fas fa-exclamation-triangle';
                        title.textContent = 'Aviso';
                        notification.style.borderLeftColor = 'var(--warning)';
                        break;
                    case 'error':
                        icon.className = 'fas fa-times-circle';
                        title.textContent = 'Erro';
                        notification.style.borderLeftColor = 'var(--danger)';
                        break;
                    default:
                        icon.className = 'fas fa-info-circle';
                        title.textContent = 'Informa√ß√£o';
                        notification.style.borderLeftColor = 'var(--primary)';
                }
                
                msg.textContent = message;
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, 4000);
            },
            
            // PWA
            checkPWAInstall() {
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    document.getElementById('installPrompt').classList.remove('active');
                }
            },
            
            showInstallPrompt() {
                document.getElementById('installPrompt').classList.add('active');
                
                setTimeout(() => {
                    document.getElementById('installPrompt').classList.remove('active');
                }, 30000);
            },
            
            hideInstallPrompt() {
                document.getElementById('installPrompt').classList.remove('active');
            },
            
            async installPWA() {
                if (!this.state.deferredPrompt) return;
                
                this.state.deferredPrompt.prompt();
                const { outcome } = await this.state.deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    this.showNotification('SYNTA ser√° instalado em breve!', 'success');
                }
                
                this.state.deferredPrompt = null;
                this.hideInstallPrompt();
            },
            
            // Utilit√°rios
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },
            
            formatTime(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                
                if (diff < 60000) return 'Agora mesmo';
                if (diff < 3600000) return `${Math.floor(diff / 60000)} min atr√°s`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)} h atr√°s`;
                if (diff < 604800000) return `${Math.floor(diff / 86400000)} d atr√°s`;
                
                return new Date(timestamp).toLocaleDateString();
            },
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            
            // Fun√ß√£o auxiliar para simular resposta (demo)
            simulateReply() {
                if (!this.state.selectedConversation) return;
                
                const otherParticipant = this.state.selectedConversation.participants.find(
                    p => p !== this.state.currentUser.code
                );
                
                const replies = [
                    'Obrigado pelo interesse!',
                    'Podemos conversar mais sobre isso?',
                    'Que √≥timo! Quando voc√™ est√° dispon√≠vel?',
                    'Tenho algumas perguntas sobre sua proposta.',
                    'Vamos marcar uma conversa?'
                ];
                
                const reply = replies[Math.floor(Math.random() * replies.length)];
                
                const message = {
                    id: this.generateId(),
                    sender: otherParticipant,
                    content: reply,
                    timestamp: Date.now(),
                    read: false
                };
                
                this.state.selectedConversation.messages.push(message);
                this.state.selectedConversation.lastMessage = reply;
                this.state.selectedConversation.lastMessageTime = Date.now();
                this.state.selectedConversation.unread = true;
                
                this.saveToStorage();
                
                // Atualizar se estiver na p√°gina de chat
                if (this.state.currentPage === 'chat') {
                    this.loadChat();
                } else {
                    this.showNotification('Nova mensagem recebida', 'info');
                    this.updateMessageBadge();
                }
            },
            
            // Fun√ß√µes do sistema de posts do usu√°rio
            loadMyPosts() {
                if (!this.state.currentUser) return;
                
                const container = document.getElementById('myPostsGrid');
                const emptyState = document.getElementById('emptyMyPosts');
                
                const myPosts = this.state.posts.filter(post => 
                    post.author === this.state.currentUser.code
                );
                
                if (myPosts.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('d-none');
                    return;
                }
                
                emptyState.classList.add('d-none');
                
                let html = '';
                
                myPosts.forEach(post => {
                    const category = this.config.categories.find(c => c.id === post.category);
                    const timeAgo = this.formatTime(post.createdAt);
                    const statusText = post.status === 'active' ? 'Ativa' : 
                                      post.status === 'paused' ? 'Pausada' : 'Encerrada';
                    const statusColor = post.status === 'active' ? 'var(--accent)' : 
                                       post.status === 'paused' ? 'var(--warning)' : 'var(--danger)';
                    
                    html += `
                        <div class="post-card" data-post-id="${post.id}">
                            <div class="post-header">
                                <div class="d-flex justify-between align-center mb-2">
                                    <span class="post-category" style="background: ${category.color}20; color: ${category.color};">
                                        <i class="fas ${category.icon}"></i> ${category.name}
                                    </span>
                                    <span style="color: ${statusColor}; font-weight: 600; font-size: 0.875rem;">
                                        ${statusText}
                                    </span>
                                </div>
                                <h3 class="post-title">${this.escapeHtml(post.title)}</h3>
                                <p class="post-description">${this.escapeHtml(post.description)}</p>
                                <div class="text-muted mt-2" style="font-size: 0.875rem;">
                                    <i class="fas fa-hashtag"></i> ${post.postCode} ‚Ä¢ 
                                    <i class="fas fa-key"></i> ${post.entryCode}
                                </div>
                            </div>
                            <div class="post-footer">
                                <div class="post-meta">
                                    <span><i class="far fa-clock"></i> ${timeAgo}</span>
                                    <span><i class="fas fa-comment"></i> ${post.proposals || 0}</span>
                                    <span><i class="fas fa-eye"></i> ${post.views || 0}</span>
                                </div>
                                <button class="btn btn-primary btn-small edit-my-post-btn" data-id="${post.id}">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Adicionar event listeners
                document.querySelectorAll('.edit-my-post-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = e.currentTarget.dataset.id;
                        this.editMyPost(postId);
                    });
                });
            },
            
            // Editar post do usu√°rio
            editMyPost(postId) {
                const post = this.state.posts.find(p => p.id === postId);
                if (!post) return;
                
                const content = `
                    <div class="mb-4">
                        <div class="alert alert-info">
                            <div class="d-flex align-center gap-1">
                                <i class="fas fa-info-circle"></i>
                                <div>
                                    <strong>Editando:</strong> ${this.escapeHtml(post.title)}
                                    <div class="text-muted" style="font-size: 0.875rem;">
                                        C√≥digo: ${post.postCode} | Criado: ${this.formatTime(post.createdAt)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="editPostForm">
                        <input type="hidden" id="editPostId" value="${post.id}">
                        
                        <div class="form-group">
                            <label class="form-label">T√≠tulo * (max 100 caracteres)</label>
                            <input type="text" class="form-control" id="editPostTitle" 
                                   value="${this.escapeHtml(post.title)}" required maxlength="100">
                            <div class="form-hint" id="editTitleCounter">${post.title.length}/100 caracteres</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o * (max 500 caracteres)</label>
                            <textarea class="form-control" id="editPostDescription" rows="4" required maxlength="500">${this.escapeHtml(post.description)}</textarea>
                            <div class="form-hint" id="editDescCounter">${post.description.length}/500 caracteres</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email para contato</label>
                            <input type="email" class="form-control" id="editPostEmail" 
                                   value="${post.email || ''}" placeholder="seu@email.com">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-control" id="editPostStatus">
                                <option value="active" ${post.status === 'active' ? 'selected' : ''}>Ativa</option>
                                <option value="paused" ${post.status === 'paused' ? 'selected' : ''}>Pausada</option>
                                <option value="closed" ${post.status === 'closed' ? 'selected' : ''}>Encerrada</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2 mt-4">
                            <button type="button" class="btn btn-danger" id="deletePostBtn">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                            <div style="flex: 1;"></div>
                            <button type="button" class="btn btn-secondary" id="cancelEditBtn">
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Altera√ß√µes
                            </button>
                        </div>
                    </form>
                `;
                
                document.getElementById('editPostContent').innerHTML = content;
                
                // Adicionar event listeners
                const editForm = document.getElementById('editPostForm');
                if (editForm) {
                    editForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.updatePost(post.id);
                    });
                }
                
                document.getElementById('deletePostBtn').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja excluir esta postagem?')) {
                        this.deletePost(post.id);
                    }
                });
                
                document.getElementById('cancelEditBtn').addEventListener('click', () => {
                    this.hideModal('editPostModal');
                });
                
                // Contadores de caracteres
                const titleInput = document.getElementById('editPostTitle');
                const descInput = document.getElementById('editPostDescription');
                const titleCounter = document.getElementById('editTitleCounter');
                const descCounter = document.getElementById('editDescCounter');
                
                if (titleInput && titleCounter) {
                    titleInput.addEventListener('input', () => {
                        titleCounter.textContent = `${titleInput.value.length}/100 caracteres`;
                    });
                }
                
                if (descInput && descCounter) {
                    descInput.addEventListener('input', () => {
                        descCounter.textContent = `${descInput.value.length}/500 caracteres`;
                    });
                }
                
                this.showModal('editPostModal');
            },
            
            // Atualizar post
            updatePost(postId) {
                const postIndex = this.state.posts.findIndex(p => p.id === postId);
                
                if (postIndex === -1) {
                    this.showNotification('Postagem n√£o encontrada', 'error');
                    return;
                }
                
                const title = document.getElementById('editPostTitle').value.trim();
                const description = document.getElementById('editPostDescription').value.trim();
                const email = document.getElementById('editPostEmail').value.trim();
                const status = document.getElementById('editPostStatus').value;
                
                // Valida√ß√µes
                if (!title || !description) {
                    this.showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                    return;
                }
                
                if (title.length > 100) {
                    this.showNotification('T√≠tulo muito longo', 'error');
                    return;
                }
                
                if (description.length > 500) {
                    this.showNotification('Descri√ß√£o muito longa', 'error');
                    return;
                }
                
                if (email && !this.validateEmail(email)) {
                    this.showNotification('Email inv√°lido', 'error');
                    return;
                }
                
                // Atualizar post
                this.state.posts[postIndex].title = title;
                this.state.posts[postIndex].description = description;
                this.state.posts[postIndex].email = email || null;
                this.state.posts[postIndex].status = status;
                this.state.posts[postIndex].updatedAt = Date.now();
                
                this.saveToStorage();
                this.hideModal('editPostModal');
                this.showNotification('Postagem atualizada com sucesso!', 'success');
                
                // Atualizar visualiza√ß√£o
                this.loadPosts();
                if (this.state.currentPage === 'myPosts') {
                    this.loadMyPosts();
                }
            },
            
            // Excluir post
            deletePost(postId) {
                const postIndex = this.state.posts.findIndex(p => p.id === postId);
                
                if (postIndex === -1) {
                    this.showNotification('Postagem n√£o encontrada', 'error');
                    return;
                }
                
                this.state.posts.splice(postIndex, 1);
                
                // Remover conversas relacionadas
                this.state.conversations = this.state.conversations.filter(conv => 
                    conv.postId !== postId
                );
                
                this.saveToStorage();
                this.hideModal('editPostModal');
                this.showNotification('Postagem exclu√≠da com sucesso!', 'success');
                
                // Atualizar visualiza√ß√£o
                this.loadPosts();
                if (this.state.currentPage === 'myPosts') {
                    this.loadMyPosts();
                }
            },
            
            // Carregar post por c√≥digo de edi√ß√£o
            loadPostByEditCode() {
                const code = document.getElementById('editCodeInput').value.trim().toUpperCase();
                
                if (!this.validateCode(code, 'entry')) {
                    this.showNotification('C√≥digo de edi√ß√£o inv√°lido', 'error');
                    return;
                }
                
                const post = this.state.posts.find(p => p.entryCode === code);
                
                if (!post) {
                    this.showNotification('Postagem n√£o encontrada', 'error');
                    return;
                }
                
                // Verificar se o usu√°rio atual √© o autor
                if (post.author !== this.state.currentUser.code) {
                    this.showNotification('Voc√™ n√£o tem permiss√£o para editar esta postagem', 'error');
                    return;
                }
                
                this.editMyPost(post.id);
            },
            
            // Resetar sistema
            resetSystem() {
                localStorage.removeItem(this.config.storageKey);
                this.state = {
                    currentUser: null,
                    currentPage: 'feed',
                    userLocation: null,
                    map: null,
                    posts: [],
                    conversations: [],
                    users: {},
                    ratings: [],
                    reports: [],
                    selectedPost: null,
                    selectedConversation: null,
                    deferredPrompt: null,
                    isAdmin: false,
                    gpsStatus: 'checking',
                    ratingInProgress: false
                };
                
                document.getElementById('dashboardContent').classList.add('d-none');
                document.getElementById('accessScreen').classList.remove('d-none');
                document.getElementById('adminNav').classList.add('d-none');
                
                this.showNotification('Sistema resetado com sucesso', 'success');
            },
            
            // Salvar configura√ß√µes do sistema
            saveSystemSettings() {
                const autoModeration = document.getElementById('autoModeration').checked;
                const emailNotifications = document.getElementById('emailNotifications').checked;
                const ratingSystem = document.getElementById('ratingSystem').checked;
                
                // Salvar configura√ß√µes
                localStorage.setItem('syntax_settings', JSON.stringify({
                    autoModeration,
                    emailNotifications,
                    ratingSystem,
                    savedAt: Date.now()
                }));
                
                this.showNotification('Configura√ß√µes salvas', 'success');
            },
            
            // Fun√ß√µes auxiliares para admin
            deleteUser(code) {
                if (code === this.config.adminCode) {
                    this.showNotification('N√£o √© poss√≠vel deletar o administrador', 'error');
                    return;
                }
                
                if (confirm(`Deletar usu√°rio ${code}?`)) {
                    delete this.state.users[code];
                    
                    // Remover posts do usu√°rio
                    this.state.posts = this.state.posts.filter(post => post.author !== code);
                    
                    // Remover conversas do usu√°rio
                    this.state.conversations = this.state.conversations.filter(conv => 
                        !conv.participants.includes(code)
                    );
                    
                    // Remover avalia√ß√µes do usu√°rio
                    this.state.ratings = this.state.ratings.filter(r => 
                        r.fromUser !== code && r.toUser !== code
                    );
                    
                    // Remover den√∫ncias do usu√°rio
                    this.state.reports = this.state.reports.filter(r => 
                        r.reporter !== code && r.reportedUser !== code
                    );
                    
                    this.saveToStorage();
                    this.loadAdminUsersTable();
                    this.showNotification('Usu√°rio deletado', 'success');
                }
            },
            
            viewReport(reportId) {
                const report = this.state.reports.find(r => r.id === reportId);
                if (!report) return;
                
                const reporter = this.state.users[report.reporter] || { name: 'Usu√°rio Desconhecido' };
                const reportedUser = this.state.users[report.reportedUser] || { name: 'Usu√°rio Desconhecido' };
                const date = new Date(report.createdAt).toLocaleString();
                
                alert(`
                    Detalhes da Den√∫ncia:
                    
                    ID: ${report.id}
                    Data: ${date}
                    
                    Denunciante: ${reporter.name} (${report.reporter})
                    Denunciado: ${reportedUser.name} (${report.reportedUser})
                    
                    Motivo: ${report.reason}
                    Descri√ß√£o: ${report.description}
                    
                    Status: ${report.status}
                `);
            }
        };
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            SYNTA.init();
        });
        
        // Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swContent = `
                    self.addEventListener('install', event => {
                        console.log('Service Worker instalado');
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', event => {
                        console.log('Service Worker ativado');
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(fetch(event.request));
                    });
                `;
                
                const blob = new Blob([swContent], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL).catch(console.error);
            });
        }
        
        // Expor SYNTA globalmente para testes
        window.SYNTA = SYNTA;
    </script>
</body>
</html>